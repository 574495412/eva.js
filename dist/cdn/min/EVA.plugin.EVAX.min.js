!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@eva/eva.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).EVA=t.EVA||{},t.EVA.plugin=t.EVA.plugin||{},t.EVA.plugin.EVAX={}),t.EVA)}(this,(function(t,e){"use strict";function r(t,e,r,n){var o,c=arguments.length,i=c<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(c<3?o(i):c>3?o(e,r,i):o(e,r))||i);return c>3&&i&&Object.defineProperty(e,r,i),i}class n extends e.Component{constructor(t){super(t),this.events={}}init(t={events:{}}){const{events:e}=t;this.events=e||{}}}n.componentName="EvaX",r([e.decorators.IDEProp],n.prototype,"events",void 0);var o=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function c(t,e,n,c,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,c||t,i),s=r?r+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],a]:t._events[s].push(a):(t._events[s]=a,t._eventsCount++),t}function i(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,c=n.length,i=new Array(c);o<c;o++)i[o]=n[o].fn;return i},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,o,c,i){var a=r?r+t:t;if(!this._events[a])return!1;var s,u,f=this._events[a],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,o),!0;case 5:return f.fn.call(f.context,e,n,o,c),!0;case 6:return f.fn.call(f.context,e,n,o,c,i),!0}for(u=1,s=new Array(l-1);u<l;u++)s[u-1]=arguments[u];f.fn.apply(f.context,s)}else{var p,h=f.length;for(u=0;u<h;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,e);break;case 3:f[u].fn.call(f[u].context,e,n);break;case 4:f[u].fn.call(f[u].context,e,n,o);break;default:if(!s)for(p=1,s=new Array(l-1);p<l;p++)s[p-1]=arguments[p];f[u].fn.apply(f[u].context,s)}}return!0},a.prototype.on=function(t,e,r){return c(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return c(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,o){var c=r?r+t:t;if(!this._events[c])return this;if(!e)return i(this,c),this;var a=this._events[c];if(a.fn)a.fn!==e||o&&!a.once||n&&a.context!==n||i(this,c);else{for(var s=0,u=[],f=a.length;s<f;s++)(a[s].fn!==e||o&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);u.length?this._events[c]=1===u.length?u[0]:u:i(this,c)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&i(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}));function c(t,e){return t===e||t!=t&&e!=e}function i(t,e){for(var r=t.length;r--;)if(c(t[r][0],e))return r;return-1}var a=Array.prototype.splice;function s(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}s.prototype.clear=function(){this.__data__=[],this.size=0},s.prototype.delete=function(t){var e=this.__data__,r=i(e,t);return!(r<0)&&(r==e.length-1?e.pop():a.call(e,r,1),--this.size,!0)},s.prototype.get=function(t){var e=this.__data__,r=i(e,t);return r<0?void 0:e[r][1]},s.prototype.has=function(t){return i(this.__data__,t)>-1},s.prototype.set=function(t,e){var r=this.__data__,n=i(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var u="object"==typeof global&&global&&global.Object===Object&&global,f="object"==typeof self&&self&&self.Object===Object&&self,l=u||f||Function("return this")(),p=l.Symbol,h=Object.prototype,v=h.hasOwnProperty,b=h.toString,y=p?p.toStringTag:void 0;var d=Object.prototype.toString;var j=p?p.toStringTag:void 0;function _(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":j&&j in Object(t)?function(t){var e=v.call(t,y),r=t[y];try{t[y]=void 0;var n=!0}catch(t){}var o=b.call(t);return n&&(e?t[y]=r:delete t[y]),o}(t):function(t){return d.call(t)}(t)}function g(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function O(t){if(!g(t))return!1;var e=_(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var m,w=l["__core-js_shared__"],A=(m=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"";var x=Function.prototype.toString;function S(t){if(null!=t){try{return x.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var E=/^\[object .+?Constructor\]$/,P=Function.prototype,z=Object.prototype,U=P.toString,F=z.hasOwnProperty,L=RegExp("^"+U.call(F).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function k(t){return!(!g(t)||(e=t,A&&A in e))&&(O(t)?L:E).test(S(t));var e}function T(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return k(r)?r:void 0}var D=T(l,"Map"),I=T(Object,"create");var V=Object.prototype.hasOwnProperty;var C=Object.prototype.hasOwnProperty;function M(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function R(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function B(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}M.prototype.clear=function(){this.__data__=I?I(null):{},this.size=0},M.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},M.prototype.get=function(t){var e=this.__data__;if(I){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return V.call(e,t)?e[t]:void 0},M.prototype.has=function(t){var e=this.__data__;return I?void 0!==e[t]:C.call(e,t)},M.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=I&&void 0===e?"__lodash_hash_undefined__":e,this},B.prototype.clear=function(){this.size=0,this.__data__={hash:new M,map:new(D||s),string:new M}},B.prototype.delete=function(t){var e=R(this,t).delete(t);return this.size-=e?1:0,e},B.prototype.get=function(t){return R(this,t).get(t)},B.prototype.has=function(t){return R(this,t).has(t)},B.prototype.set=function(t,e){var r=R(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function $(t){var e=this.__data__=new s(t);this.size=e.size}$.prototype.clear=function(){this.__data__=new s,this.size=0},$.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},$.prototype.get=function(t){return this.__data__.get(t)},$.prototype.has=function(t){return this.__data__.has(t)},$.prototype.set=function(t,e){var r=this.__data__;if(r instanceof s){var n=r.__data__;if(!D||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new B(n)}return r.set(t,e),this.size=r.size,this};var N=function(){try{var t=T(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function X(t,e,r){"__proto__"==e&&N?N(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var W=Object.prototype.hasOwnProperty;function q(t,e,r){var n=t[e];W.call(t,e)&&c(n,r)&&(void 0!==r||e in t)||X(t,e,r)}function G(t,e,r,n){var o=!r;r||(r={});for(var c=-1,i=e.length;++c<i;){var a=e[c],s=n?n(r[a],t[a],a,r,t):void 0;void 0===s&&(s=t[a]),o?X(r,a,s):q(r,a,s)}return r}function Y(t){return null!=t&&"object"==typeof t}function H(t){return Y(t)&&"[object Arguments]"==_(t)}var J=Object.prototype,K=J.hasOwnProperty,Q=J.propertyIsEnumerable,Z=H(function(){return arguments}())?H:function(t){return Y(t)&&K.call(t,"callee")&&!Q.call(t,"callee")},tt=Array.isArray;var et="object"==typeof t&&t&&!t.nodeType&&t,rt=et&&"object"==typeof module&&module&&!module.nodeType&&module,nt=rt&&rt.exports===et?l.Buffer:void 0,ot=(nt?nt.isBuffer:void 0)||function(){return!1},ct=/^(?:0|[1-9]\d*)$/;function it(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&ct.test(t))&&t>-1&&t%1==0&&t<e}function at(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var st={};function ut(t){return function(e){return t(e)}}st["[object Float32Array]"]=st["[object Float64Array]"]=st["[object Int8Array]"]=st["[object Int16Array]"]=st["[object Int32Array]"]=st["[object Uint8Array]"]=st["[object Uint8ClampedArray]"]=st["[object Uint16Array]"]=st["[object Uint32Array]"]=!0,st["[object Arguments]"]=st["[object Array]"]=st["[object ArrayBuffer]"]=st["[object Boolean]"]=st["[object DataView]"]=st["[object Date]"]=st["[object Error]"]=st["[object Function]"]=st["[object Map]"]=st["[object Number]"]=st["[object Object]"]=st["[object RegExp]"]=st["[object Set]"]=st["[object String]"]=st["[object WeakMap]"]=!1;var ft="object"==typeof t&&t&&!t.nodeType&&t,lt=ft&&"object"==typeof module&&module&&!module.nodeType&&module,pt=lt&&lt.exports===ft&&u.process,ht=function(){try{var t=lt&&lt.require&&lt.require("util").types;return t||pt&&pt.binding&&pt.binding("util")}catch(t){}}(),vt=ht&&ht.isTypedArray,bt=vt?ut(vt):function(t){return Y(t)&&at(t.length)&&!!st[_(t)]},yt=Object.prototype.hasOwnProperty;function dt(t,e){var r=tt(t),n=!r&&Z(t),o=!r&&!n&&ot(t),c=!r&&!n&&!o&&bt(t),i=r||n||o||c,a=i?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=a.length;for(var u in t)!e&&!yt.call(t,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||c&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||it(u,s))||a.push(u);return a}var jt=Object.prototype;function _t(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||jt)}function gt(t,e){return function(r){return t(e(r))}}var Ot=gt(Object.keys,Object),mt=Object.prototype.hasOwnProperty;function wt(t){return null!=t&&at(t.length)&&!O(t)}function At(t){return wt(t)?dt(t):function(t){if(!_t(t))return Ot(t);var e=[];for(var r in Object(t))mt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}var xt=Object.prototype.hasOwnProperty;function St(t){if(!g(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=_t(t),r=[];for(var n in t)("constructor"!=n||!e&&xt.call(t,n))&&r.push(n);return r}function Et(t){return wt(t)?dt(t,!0):St(t)}var Pt="object"==typeof t&&t&&!t.nodeType&&t,zt=Pt&&"object"==typeof module&&module&&!module.nodeType&&module,Ut=zt&&zt.exports===Pt?l.Buffer:void 0,Ft=Ut?Ut.allocUnsafe:void 0;function Lt(){return[]}var kt=Object.prototype.propertyIsEnumerable,Tt=Object.getOwnPropertySymbols,Dt=Tt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,c=[];++r<n;){var i=t[r];e(i,r,t)&&(c[o++]=i)}return c}(Tt(t),(function(e){return kt.call(t,e)})))}:Lt;function It(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var Vt=gt(Object.getPrototypeOf,Object),Ct=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)It(e,Dt(t)),t=Vt(t);return e}:Lt;function Mt(t,e,r){var n=e(t);return tt(t)?n:It(n,r(t))}function Rt(t){return Mt(t,At,Dt)}function Bt(t){return Mt(t,Et,Ct)}var $t=T(l,"DataView"),Nt=T(l,"Promise"),Xt=T(l,"Set"),Wt=T(l,"WeakMap"),qt="[object Map]",Gt="[object Promise]",Yt="[object Set]",Ht="[object WeakMap]",Jt="[object DataView]",Kt=S($t),Qt=S(D),Zt=S(Nt),te=S(Xt),ee=S(Wt),re=_;($t&&re(new $t(new ArrayBuffer(1)))!=Jt||D&&re(new D)!=qt||Nt&&re(Nt.resolve())!=Gt||Xt&&re(new Xt)!=Yt||Wt&&re(new Wt)!=Ht)&&(re=function(t){var e=_(t),r="[object Object]"==e?t.constructor:void 0,n=r?S(r):"";if(n)switch(n){case Kt:return Jt;case Qt:return qt;case Zt:return Gt;case te:return Yt;case ee:return Ht}return e});var ne=re,oe=Object.prototype.hasOwnProperty;var ce=l.Uint8Array;function ie(t){var e=new t.constructor(t.byteLength);return new ce(e).set(new ce(t)),e}var ae=/\w*$/;var se=p?p.prototype:void 0,ue=se?se.valueOf:void 0;function fe(t,e,r){var n,o,c,i=t.constructor;switch(e){case"[object ArrayBuffer]":return ie(t);case"[object Boolean]":case"[object Date]":return new i(+t);case"[object DataView]":return function(t,e){var r=e?ie(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,e){var r=e?ie(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case"[object Map]":return new i;case"[object Number]":case"[object String]":return new i(t);case"[object RegExp]":return(c=new(o=t).constructor(o.source,ae.exec(o))).lastIndex=o.lastIndex,c;case"[object Set]":return new i;case"[object Symbol]":return n=t,ue?Object(ue.call(n)):{}}}var le=Object.create,pe=function(){function t(){}return function(e){if(!g(e))return{};if(le)return le(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var he=ht&&ht.isMap,ve=he?ut(he):function(t){return Y(t)&&"[object Map]"==ne(t)};var be=ht&&ht.isSet,ye=be?ut(be):function(t){return Y(t)&&"[object Set]"==ne(t)},de="[object Arguments]",je="[object Function]",_e="[object Object]",ge={};function Oe(t,e,r,n,o,c){var i,a=1&e,s=2&e,u=4&e;if(r&&(i=o?r(t,n,o,c):r(t)),void 0!==i)return i;if(!g(t))return t;var f=tt(t);if(f){if(i=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&oe.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!a)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,i)}else{var l=ne(t),p=l==je||"[object GeneratorFunction]"==l;if(ot(t))return function(t,e){if(e)return t.slice();var r=t.length,n=Ft?Ft(r):new t.constructor(r);return t.copy(n),n}(t,a);if(l==_e||l==de||p&&!o){if(i=s||p?{}:function(t){return"function"!=typeof t.constructor||_t(t)?{}:pe(Vt(t))}(t),!a)return s?function(t,e){return G(t,Ct(t),e)}(t,function(t,e){return t&&G(e,Et(e),t)}(i,t)):function(t,e){return G(t,Dt(t),e)}(t,function(t,e){return t&&G(e,At(e),t)}(i,t))}else{if(!ge[l])return o?t:{};i=fe(t,l,a)}}c||(c=new $);var h=c.get(t);if(h)return h;c.set(t,i),ye(t)?t.forEach((function(n){i.add(Oe(n,e,r,n,t,c))})):ve(t)&&t.forEach((function(n,o){i.set(o,Oe(n,e,r,o,t,c))}));var v=f?void 0:(u?s?Bt:Rt:s?Et:At)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(v||t,(function(n,o){v&&(n=t[o=n]),q(i,o,Oe(n,e,r,o,t,c))})),i}ge[de]=ge["[object Array]"]=ge["[object ArrayBuffer]"]=ge["[object DataView]"]=ge["[object Boolean]"]=ge["[object Date]"]=ge["[object Float32Array]"]=ge["[object Float64Array]"]=ge["[object Int8Array]"]=ge["[object Int16Array]"]=ge["[object Int32Array]"]=ge["[object Map]"]=ge["[object Number]"]=ge[_e]=ge["[object RegExp]"]=ge["[object Set]"]=ge["[object String]"]=ge["[object Symbol]"]=ge["[object Uint8Array]"]=ge["[object Uint8ClampedArray]"]=ge["[object Uint16Array]"]=ge["[object Uint32Array]"]=!0,ge["[object Error]"]=ge[je]=ge["[object WeakMap]"]=!1;const me=new Map;function we(t,e,r,n,o,c){if(me.has(r)||me.set(r,[]),me.get(r).indexOf(t)>-1)return;me.get(r).push(t);const i=t.split(".");let a=r;const s=i.length;for(let t=0;t<s-1;t++){if(void 0===a[i[t]])return;a=a[i[t]]}const u=a[i[s-1]];if(e&&g(u))for(const t in u)we(t,e,u,n,o,c);const f=`_${i[s-1]}`;a[f]=u,Object.defineProperty(a,f,{enumerable:!1}),Object.defineProperty(a,i[s-1],{set(t){const r=function(t){return Oe(t,5)}(o);if(a[`_${i[s-1]}`]=t,c(n,r),e&&g(t)){me.delete(a);for(const r in t)we(r,e,t,n,o,c)}},get:()=>a[`_${i[s-1]}`]})}function Ae(t,e,r){for(const n in t)n in e&&("object"==typeof t[n]?Ae(t[n],e[n],r):(r||t[n]!==e[n])&&(t[n]=e[n]))}let xe=class extends e.System{constructor(){super(...arguments),this.changeList=[]}init({store:t={}}={store:{}}){this.ee=new o,this.store=t,this.bindDefaultListener()}bindDefaultListener(){this.ee.on("evax.updateStore",(t=>{this.updateStore(t)})),this.ee.on("evax.forceUpdateStore",(t=>{this.forceUpdateStore(t)}))}changeCallback(t,e){this.changeList.push({key:t,oldStore:e})}updateStore(t){Ae(this.store,t,!1)}forceUpdateStore(t){Ae(this.store,t,!0)}bindListener(t,e){if(-1===t.indexOf("store."))return;we(t.split(".").slice(1).join("."),e,this.store,t,this.store,((t,e)=>this.changeCallback(t,e)))}update(){const t=this.componentObserver.clear();for(const r of t)switch(r.type){case e.OBSERVER_TYPE.ADD:this.add(r);break;case e.OBSERVER_TYPE.REMOVE:this.remove(r)}}lateUpdate(){for(const t of this.changeList)this.ee.emit(t.key,this.store,t.oldStore);this.changeList=[]}add(t){const e=t.component;e.evax=this;for(const t in e.events)if(e.events[t]){let r;this.bindListener(t,!!e.events[t].deep),r=e.events[t]instanceof Function?e.events[t]:e.events[t].handler,this.ee.on(t,r.bind(e))}}remove(t){const e=t.component;for(const t in e.events)e.events[t]instanceof Function&&this.ee.off(t,e.events[t].bind(e))}on(t,e){return this.ee.on(t,e,this)}off(t,e){return this.ee.off(t,e)}emit(t,...e){return this.ee.emit(t,...e)}onDestroy(){}};xe.systemName="EvaX",xe=r([e.decorators.componentObserver({EvaX:[]})],xe);var Se=xe,Ee={Components:[n],Systems:[Se]};t.EvaX=n,t.EvaXSystem=Se,t.default=Ee,Object.defineProperty(t,"__esModule",{value:!0})}));
