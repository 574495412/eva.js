var e,t;e=this,t=function(e,t,r,i){"use strict";function s(e,t,r,i){var s,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o}function n(e,t,r,i){return new(r||(r=Promise))((function(s,n){function o(e){try{a(i.next(e))}catch(e){n(e)}}function c(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}a((i=i.apply(e,t||[])).next())}))}class o extends t.Component{constructor(){super(...arguments),this.resource="",this.spriteName=""}init(e){e&&e.resource&&(this.resource=e.resource,this.spriteName=e.spriteName)}}o.componentName="Sprite",s([t.decorators.IDEProp],o.prototype,"resource",void 0),s([t.decorators.IDEProp],o.prototype,"spriteName",void 0);class c{constructor(e){this._image=null,this._image=e,e?e instanceof HTMLImageElement?this.sprite=i.Sprite.from(e):e instanceof i.Texture&&(this.sprite=new i.Sprite(e)):this.sprite=new i.Sprite}set image(e){this._image!==e&&(e instanceof HTMLImageElement?(this.sprite.texture&&this.sprite.texture.destroy(!1),this.sprite.texture=i.Texture.from(e)):e instanceof i.Texture&&(this.sprite.texture=e),this._image=e)}get image(){return this._image}}const a="_s|r|c_";t.resource.registerInstance(t.RESOURCE_TYPE.SPRITE,(({name:e,data:t})=>new Promise((r=>{const s=t.json,n=i.BaseTexture.from(t.image),o=s.frames||{},c=s.animations||{},p={};for(const t in o)p[e+a+t]=o[t];for(const t in c){const r=[];if(c[t]&&c[t].length>=0)for(const i of c[t]){const t=e+a+i;r.push(t)}c[t]=r}s.frames=p;const u=new i.Spritesheet(n,s);u.parse((()=>{const{textures:e}=u;r(e)}))})))),t.resource.registerDestroy(t.RESOURCE_TYPE.SPRITE,(({instance:e})=>{if(e)for(const t in e)e[t].destroy(!0)}));let p=class extends r.Renderer{constructor(){super(...arguments),this.name="Sprite",this.sprites={}}init(){this.renderSystem=this.game.getSystem(r.RendererSystem),this.renderSystem.rendererManager.register(this)}rendererUpdate(e){const{width:t,height:r}=e.transform.size;this.sprites[e.id]&&(this.sprites[e.id].sprite.width=t,this.sprites[e.id].sprite.height=r)}componentChanged(e){return n(this,void 0,void 0,(function*(){if("Sprite"===e.componentName){const r=e.component;if(e.type===t.OBSERVER_TYPE.ADD){const i=new c(null);t.resource.getResource(r.resource).then((({instance:t})=>n(this,void 0,void 0,(function*(){if(!t)throw new Error(`GameObject:${e.gameObject.name}'s Sprite resource load error`);i.image=t[r.resource+a+r.spriteName]})))),this.sprites[e.gameObject.id]=i,this.containerManager.getContainer(e.gameObject.id).addChildAt(i.sprite,0)}else if(e.type===t.OBSERVER_TYPE.CHANGE){const{instance:i}=yield t.resource.getResource(r.resource);if(!i)throw new Error(`GameObject:${e.gameObject.name}'s Sprite resource load error`);this.sprites[e.gameObject.id].image=i[r.resource+a+r.spriteName]}else if(e.type===t.OBSERVER_TYPE.REMOVE){const t=this.sprites[e.gameObject.id];this.containerManager.getContainer(e.gameObject.id).removeChild(t.sprite),t.sprite.destroy({children:!0}),delete this.sprites[e.gameObject.id]}}}))}};p.systemName="Sprite",p=s([t.decorators.componentObserver({Sprite:["spriteName"]})],p);var u=p;e.Sprite=o,e.SpriteSystem=u,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/plugin-renderer"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/plugin-renderer","pixi.js"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer=e.EVA.plugin.renderer||{},e.EVA.plugin.renderer.sprite={}),e.EVA,e.EVA.plugin.renderer,e.PIXI);
