var e,t;e=this,t=function(e,t,r){"use strict";function n(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}class o extends t.Component{constructor(){super(...arguments),this.sortDirty=!1,this.visible=!0,this.alpha=1,this.zIndex=0,this.sortableChildren=!1}init(e){e&&Object.assign(this,e)}}o.componentName="Render",n([t.decorators.IDEProp],o.prototype,"visible",void 0),n([t.decorators.IDEProp],o.prototype,"alpha",void 0),n([t.decorators.IDEProp],o.prototype,"zIndex",void 0),n([t.decorators.IDEProp],o.prototype,"sortableChildren",void 0);let i=class extends r.Renderer{constructor(){super(...arguments),this.name="Render"}init(){this.renderSystem=this.game.getSystem(r.RendererSystem),this.renderSystem.rendererManager.register(this)}rendererUpdate(e){const t=e.getComponent("Render"),r=this.containerManager.getContainer(e.id);if(r.alpha=t.alpha,r.visible=t.visible,t.sortDirty&&t.sortableChildren){const r=e.transform.children.map((({gameObject:e})=>e)).sort(((e,t)=>{const r=e.getComponent("Render"),n=t.getComponent("Render");return r?n?r.zIndex-n.zIndex:1:-1})).map((e=>this.containerManager.getContainer(e.id))),n=this.containerManager.getContainer(t.gameObject.id).children,o=n.filter((e=>-1===r.indexOf(e)));n.length=0,n.push(...o,...r),t.sortDirty=!1}}componentChanged(e){e.type!==t.OBSERVER_TYPE.ADD&&e.type!==t.OBSERVER_TYPE.REMOVE||this.add(e),e.type===t.OBSERVER_TYPE.CHANGE&&this.change(e),e.type===t.OBSERVER_TYPE.REMOVE&&this.remove(e)}add(e){"Render"===e.component.name&&this.setDirty(e)}change(e){"Render"===e.component.name&&"zIndex"===e.prop.prop[0]&&this.setDirty(e)}remove(e){"Render"===e.component.name&&(this.containerManager.getContainer(e.gameObject.id).alpha=1)}setDirty(e){const t=e.gameObject.parent&&e.gameObject.parent.getComponent("Render");t&&(t.sortDirty=!0)}};i.systemName="Render",i=n([t.decorators.componentObserver({Render:["zIndex"]})],i);var s=i;e.Render=o,e.RenderSystem=s,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/plugin-renderer")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/plugin-renderer"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer=e.EVA.plugin.renderer||{},e.EVA.plugin.renderer.render={}),e.EVA,e.EVA.plugin.renderer);
