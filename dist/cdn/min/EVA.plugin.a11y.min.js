!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@eva/eva.js"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","pixi.js"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).EVA=t.EVA||{},t.EVA.plugin=t.EVA.plugin||{},t.EVA.plugin.a11y={}),t.EVA,t.PIXI)}(this,(function(t,e,r){"use strict";function n(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function o(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{_(n.next(t))}catch(t){i(t)}}function a(t){try{_(n.throw(t))}catch(t){i(t)}}function _(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}_((n=n.apply(t,e||[])).next())}))}const i=(t,e)=>{const{width:r,height:n,position:o,left:i=0,top:s=0,zIndex:a,pointerEvents:_,background:c}=e;t.style.width=`${r}px`,t.style.height=`${n}px`,t.style.position=o,t.style.left=`${i}`,t.style.top=`${s}`,t.style.zIndex=`${a}`,t.style.pointerEvents=_,t.style.background=c,t.style.border="none",t.style.overflow="hidden"};class s extends e.Component{constructor(t){super(),Object.assign(this,t);const{hint:e="",event:r,delay:n=0,attr:o={},role:i="",props:s={},state:a={}}=t;this.hint=e,this.event=r,this.delay=n,this.attr=o,this.role=i,this.props=s,this.state=a,this.a11yId=`_${function(t){let e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[],n=e.length;for(let o=0;o<t;o++)r[o]=e[0|Math.random()*n];return r.join("")}(6)}`}}s.componentName="A11y",n([e.decorators.IDEProp],s.prototype,"interactive",void 0),n([e.decorators.IDEProp],s.prototype,"hint",void 0),n([e.decorators.IDEProp],s.prototype,"event",void 0),n([e.decorators.IDEProp],s.prototype,"delay",void 0),n([e.decorators.IDEProp],s.prototype,"role",void 0),n([e.decorators.IDEProp],s.prototype,"props",void 0),n([e.decorators.IDEProp],s.prototype,"state",void 0),n([e.decorators.IDEProp],s.prototype,"attr",void 0),n([e.decorators.IDEProp],s.prototype,"a11yId",void 0);const a="absolute";var _,c,u,h;t.A11yActivate=void 0,(_=t.A11yActivate||(t.A11yActivate={}))[_.ENABLE=0]="ENABLE",_[_.DISABLE=1]="DISABLE",_[_.CHECK=2]="CHECK",function(t){t.NONE="none",t.AUTO="auto"}(c||(c={})),function(t){t.DEBUG="rgba(255,0,0,0.5)",t.NONE="transparent"}(u||(u={})),function(t){t.BUTTON="button",t.DIV="div"}(h||(h={}));var p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function l(t,e){function r(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var E=function(t){function e(e){return e.autoStart=!1,t.call(this,e)||this}return l(e,t),e}(r.Application),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e}(r.Container);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}l(e,t)}(r.Graphics),function(t){function e(e,n,o,i,s){var a;return a="string"===e?r.Texture.fromFrame(e):r.Texture.from(e),t.call(this,a,n,o,i,s)||this}l(e,t)}(r.mesh.NineSlicePlane),function(){function t(t){this._image=null,this._image=t,t?t instanceof HTMLImageElement?this.sprite=r.Sprite.from(t):t instanceof r.Texture&&(this.sprite=new r.Sprite(t)):this.sprite=new r.Sprite}Object.defineProperty(t.prototype,"image",{get:function(){return this._image},set:function(t){this._image!==t&&(t instanceof HTMLImageElement?(this.sprite.texture&&this.sprite.texture.destroy(!1),this.sprite.texture=r.Texture.from(t)):t instanceof r.Texture&&(this.sprite.texture=t),this._image=t)},enumerable:!1,configurable:!0})}(),function(){function t(t){var e=t.frames;this.animatedSprite=new r.extras.AnimatedSprite(e)}t.prototype.play=function(){this.animatedSprite.play()},t.prototype.stop=function(){this.animatedSprite.stop()},t.prototype.gotoAndPlay=function(t){this.animatedSprite.gotoAndPlay(t)},t.prototype.gotoAndStop=function(t){this.animatedSprite.gotoAndStop(t)},Object.defineProperty(t.prototype,"speed",{get:function(){return this.animatedSprite.animationSpeed},set:function(t){this.animatedSprite.animationSpeed=t},enumerable:!1,configurable:!0})}(),function(t){function e(e,r){return t.call(this,e,r)||this}l(e,t)}(r.Text);var f=r.extras.TilingSprite;function S(t,e){return t===e||t!=t&&e!=e}function m(t,e){for(var r=t.length;r--;)if(S(t[r][0],e))return r;return-1}!function(){function t(t){this._image=null,this._image=t,t?t instanceof HTMLImageElement?this.tilingSprite=new f(r.Texture.from(t)):t instanceof r.Texture&&(this.tilingSprite=new f(t)):this.tilingSprite=new f(r.Texture.EMPTY)}Object.defineProperty(t.prototype,"image",{get:function(){return this._image},set:function(t){this._image!==t&&(t instanceof HTMLImageElement?this.tilingSprite.texture=r.Texture.from(t):t instanceof r.Texture&&(this.tilingSprite.texture=t),this._image=t)},enumerable:!1,configurable:!0})}();var R=Array.prototype.splice;function A(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}A.prototype.clear=function(){this.__data__=[],this.size=0},A.prototype.delete=function(t){var e=this.__data__,r=m(e,t);return!(r<0)&&(r==e.length-1?e.pop():R.call(e,r,1),--this.size,!0)},A.prototype.get=function(t){var e=this.__data__,r=m(e,t);return r<0?void 0:e[r][1]},A.prototype.has=function(t){return m(this.__data__,t)>-1},A.prototype.set=function(t,e){var r=this.__data__,n=m(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var T="object"==typeof global&&global&&global.Object===Object&&global,g="object"==typeof self&&self&&self.Object===Object&&self,y=T||g||Function("return this")(),C=y.Symbol,v=Object.prototype,O=v.hasOwnProperty,P=v.toString,b=C?C.toStringTag:void 0;var D=Object.prototype.toString;var L=C?C.toStringTag:void 0;function M(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":L&&L in Object(t)?function(t){var e=O.call(t,b),r=t[b];try{t[b]=void 0;var n=!0}catch(t){}var o=P.call(t);return n&&(e?t[b]=r:delete t[b]),o}(t):function(t){return D.call(t)}(t)}function x(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function B(t){if(!x(t))return!1;var e=M(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var G,w=y["__core-js_shared__"],N=(G=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"";var I=Function.prototype.toString;function H(t){if(null!=t){try{return I.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var U=/^\[object .+?Constructor\]$/,j=Function.prototype,X=Object.prototype,k=j.toString,K=X.hasOwnProperty,V=RegExp("^"+k.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function W(t){return!(!x(t)||(e=t,N&&N in e))&&(B(t)?V:U).test(H(t));var e}function Y(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return W(r)?r:void 0}var F=Y(y,"Map"),q=Y(Object,"create");var z=Object.prototype.hasOwnProperty;var $=Object.prototype.hasOwnProperty;function J(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Q(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function Z(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}J.prototype.clear=function(){this.__data__=q?q(null):{},this.size=0},J.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},J.prototype.get=function(t){var e=this.__data__;if(q){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return z.call(e,t)?e[t]:void 0},J.prototype.has=function(t){var e=this.__data__;return q?void 0!==e[t]:$.call(e,t)},J.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=q&&void 0===e?"__lodash_hash_undefined__":e,this},Z.prototype.clear=function(){this.size=0,this.__data__={hash:new J,map:new(F||A),string:new J}},Z.prototype.delete=function(t){var e=Q(this,t).delete(t);return this.size-=e?1:0,e},Z.prototype.get=function(t){return Q(this,t).get(t)},Z.prototype.has=function(t){return Q(this,t).has(t)},Z.prototype.set=function(t,e){var r=Q(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function tt(t){var e=this.__data__=new A(t);this.size=e.size}tt.prototype.clear=function(){this.__data__=new A,this.size=0},tt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},tt.prototype.get=function(t){return this.__data__.get(t)},tt.prototype.has=function(t){return this.__data__.has(t)},tt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof A){var n=r.__data__;if(!F||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Z(n)}return r.set(t,e),this.size=r.size,this};function et(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Z;++e<r;)this.add(t[e])}function rt(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}et.prototype.add=et.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},et.prototype.has=function(t){return this.__data__.has(t)};function nt(t,e,r,n,o,i){var s=1&r,a=t.length,_=e.length;if(a!=_&&!(s&&_>a))return!1;var c=i.get(t),u=i.get(e);if(c&&u)return c==e&&u==t;var h=-1,p=!0,l=2&r?new et:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var E=t[h],d=e[h];if(n)var f=s?n(d,E,h,e,t,i):n(E,d,h,t,e,i);if(void 0!==f){if(f)continue;p=!1;break}if(l){if(!rt(e,(function(t,e){if(s=e,!l.has(s)&&(E===t||o(E,t,r,n,i)))return l.push(e);var s}))){p=!1;break}}else if(E!==d&&!o(E,d,r,n,i)){p=!1;break}}return i.delete(t),i.delete(e),p}var ot=y.Uint8Array;function it(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function st(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var at=C?C.prototype:void 0,_t=at?at.valueOf:void 0;var ct=Array.isArray;var ut=Object.prototype.propertyIsEnumerable,ht=Object.getOwnPropertySymbols,pt=ht?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i}(ht(t),(function(e){return ut.call(t,e)})))}:function(){return[]};function lt(t){return null!=t&&"object"==typeof t}function Et(t){return lt(t)&&"[object Arguments]"==M(t)}var dt=Object.prototype,ft=dt.hasOwnProperty,St=dt.propertyIsEnumerable,mt=Et(function(){return arguments}())?Et:function(t){return lt(t)&&ft.call(t,"callee")&&!St.call(t,"callee")};var Rt="object"==typeof t&&t&&!t.nodeType&&t,At=Rt&&"object"==typeof module&&module&&!module.nodeType&&module,Tt=At&&At.exports===Rt?y.Buffer:void 0,gt=(Tt?Tt.isBuffer:void 0)||function(){return!1},yt=/^(?:0|[1-9]\d*)$/;function Ct(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&yt.test(t))&&t>-1&&t%1==0&&t<e}function vt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var Ot={};Ot["[object Float32Array]"]=Ot["[object Float64Array]"]=Ot["[object Int8Array]"]=Ot["[object Int16Array]"]=Ot["[object Int32Array]"]=Ot["[object Uint8Array]"]=Ot["[object Uint8ClampedArray]"]=Ot["[object Uint16Array]"]=Ot["[object Uint32Array]"]=!0,Ot["[object Arguments]"]=Ot["[object Array]"]=Ot["[object ArrayBuffer]"]=Ot["[object Boolean]"]=Ot["[object DataView]"]=Ot["[object Date]"]=Ot["[object Error]"]=Ot["[object Function]"]=Ot["[object Map]"]=Ot["[object Number]"]=Ot["[object Object]"]=Ot["[object RegExp]"]=Ot["[object Set]"]=Ot["[object String]"]=Ot["[object WeakMap]"]=!1;var Pt,bt="object"==typeof t&&t&&!t.nodeType&&t,Dt=bt&&"object"==typeof module&&module&&!module.nodeType&&module,Lt=Dt&&Dt.exports===bt&&T.process,Mt=function(){try{var t=Dt&&Dt.require&&Dt.require("util").types;return t||Lt&&Lt.binding&&Lt.binding("util")}catch(t){}}(),xt=Mt&&Mt.isTypedArray,Bt=xt?(Pt=xt,function(t){return Pt(t)}):function(t){return lt(t)&&vt(t.length)&&!!Ot[M(t)]},Gt=Object.prototype.hasOwnProperty;function wt(t,e){var r=ct(t),n=!r&&mt(t),o=!r&&!n&&gt(t),i=!r&&!n&&!o&&Bt(t),s=r||n||o||i,a=s?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],_=a.length;for(var c in t)!e&&!Gt.call(t,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ct(c,_))||a.push(c);return a}var Nt=Object.prototype;var It=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Ht=Object.prototype.hasOwnProperty;function Ut(t){if(r=(e=t)&&e.constructor,e!==("function"==typeof r&&r.prototype||Nt))return It(t);var e,r,n=[];for(var o in Object(t))Ht.call(t,o)&&"constructor"!=o&&n.push(o);return n}function jt(t){return null!=(e=t)&&vt(e.length)&&!B(e)?wt(t):Ut(t);var e}function Xt(t){return function(t,e,r){var n=e(t);return ct(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,jt,pt)}var kt=Object.prototype.hasOwnProperty;var Kt=Y(y,"DataView"),Vt=Y(y,"Promise"),Wt=Y(y,"Set"),Yt=Y(y,"WeakMap"),Ft="[object Map]",qt="[object Promise]",zt="[object Set]",$t="[object WeakMap]",Jt="[object DataView]",Qt=H(Kt),Zt=H(F),te=H(Vt),ee=H(Wt),re=H(Yt),ne=M;(Kt&&ne(new Kt(new ArrayBuffer(1)))!=Jt||F&&ne(new F)!=Ft||Vt&&ne(Vt.resolve())!=qt||Wt&&ne(new Wt)!=zt||Yt&&ne(new Yt)!=$t)&&(ne=function(t){var e=M(t),r="[object Object]"==e?t.constructor:void 0,n=r?H(r):"";if(n)switch(n){case Qt:return Jt;case Zt:return Ft;case te:return qt;case ee:return zt;case re:return $t}return e});var oe=ne,ie="[object Arguments]",se="[object Array]",ae="[object Object]",_e=Object.prototype.hasOwnProperty;function ce(t,e,r,n,o,i){var s=ct(t),a=ct(e),_=s?se:oe(t),c=a?se:oe(e),u=(_=_==ie?ae:_)==ae,h=(c=c==ie?ae:c)==ae,p=_==c;if(p&&gt(t)){if(!gt(e))return!1;s=!0,u=!1}if(p&&!u)return i||(i=new tt),s||Bt(t)?nt(t,e,r,n,o,i):function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new ot(t),new ot(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return S(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=it;case"[object Set]":var _=1&n;if(a||(a=st),t.size!=e.size&&!_)return!1;var c=s.get(t);if(c)return c==e;n|=2,s.set(t,e);var u=nt(a(t),a(e),n,o,i,s);return s.delete(t),u;case"[object Symbol]":if(_t)return _t.call(t)==_t.call(e)}return!1}(t,e,_,r,n,o,i);if(!(1&r)){var l=u&&_e.call(t,"__wrapped__"),E=h&&_e.call(e,"__wrapped__");if(l||E){var d=l?t.value():t,f=E?e.value():e;return i||(i=new tt),o(d,f,r,n,i)}}return!!p&&(i||(i=new tt),function(t,e,r,n,o,i){var s=1&r,a=Xt(t),_=a.length;if(_!=Xt(e).length&&!s)return!1;for(var c=_;c--;){var u=a[c];if(!(s?u in e:kt.call(e,u)))return!1}var h=i.get(t),p=i.get(e);if(h&&p)return h==e&&p==t;var l=!0;i.set(t,e),i.set(e,t);for(var E=s;++c<_;){var d=t[u=a[c]],f=e[u];if(n)var S=s?n(f,d,u,e,t,i):n(d,f,u,t,e,i);if(!(void 0===S?d===f||o(d,f,r,n,i):S)){l=!1;break}E||(E="constructor"==u)}if(l&&!E){var m=t.constructor,R=e.constructor;m==R||!("constructor"in t)||!("constructor"in e)||"function"==typeof m&&m instanceof m&&"function"==typeof R&&R instanceof R||(l=!1)}return i.delete(t),i.delete(e),l}(t,e,r,n,o,i))}function ue(t,e,r,n,o){return t===e||(null==t||null==e||!lt(t)&&!lt(e)?t!=t&&e!=e:ce(t,e,r,n,ue,o))}class he{constructor({game:t,rendererSystem:e}){this.renderers=[],this.game=t,this.rendererSystem=e}register(...t){for(const e of t)e.game=this.game,e.rendererManager=this.rendererSystem.rendererManager,e.containerManager=this.rendererSystem.containerManager,this.renderers.push(e)}componentChanged(t){for(const r of t)for(const t of this.renderers){const n=t.observerInfo[r.componentName];if(n){if([e.OBSERVER_TYPE.ADD,e.OBSERVER_TYPE.REMOVE].indexOf(r.type)>-1){try{t.componentChanged&&t.componentChanged(r)}catch(t){console.error(`gameObject: ${r.gameObject.name}, ${r.componentName} is error.`,r,t)}continue}if(n.findIndex((t=>{return e=t,n=r.prop,ue(e,n);var e,n}))>-1)try{t.componentChanged&&t.componentChanged(r)}catch(t){console.error(`gameObject: ${r.gameObject&&r.gameObject.name}, ${r.componentName} is componentChanged error.`,r,t)}}}}update(t){for(const e of t.components)for(const r of this.renderers){const n=[];if(r.observerInfo[e.name]&&-1===n.indexOf(t)){n.push(t);try{r.rendererUpdate&&r.rendererUpdate(t)}catch(r){console.info(`gameObject: ${t.name}, ${e.name} is update error`,r)}}}}}class pe{constructor(){this.containerMap={}}addContainer({name:t,container:e}){this.containerMap[t]=e}getContainer(t){return this.containerMap[t]}removeContainer(t){var e;null===(e=this.containerMap[t])||void 0===e||e.destroy(!0),delete this.containerMap[t]}updateTransform({name:t,transform:e}){const r=this.containerMap[t];if(!r)return;const{anchor:n,origin:o,position:i,rotation:s,scale:a,size:_,skew:c}=e;r.rotation=s,r.scale=a,r.pivot.x=_.width*o.x,r.pivot.y=_.height*o.y,r.skew=c;let u=i.x,h=i.y;if(e.parent){const t=e.parent;u+=t.size.width*n.x,h+=t.size.height*n.y}r.position={x:u,y:h}}}var le=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(t,e,n,i,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||t,s),_=r?r+e:e;return t._events[_]?t._events[_].fn?t._events[_]=[t._events[_],a]:t._events[_].push(a):(t._events[_]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,o,i,s){var a=r?r+t:t;if(!this._events[a])return!1;var _,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,o),!0;case 5:return u.fn.call(u.context,e,n,o,i),!0;case 6:return u.fn.call(u.context,e,n,o,i,s),!0}for(c=1,_=new Array(h-1);c<h;c++)_[c-1]=arguments[c];u.fn.apply(u.context,_)}else{var p,l=u.length;for(c=0;c<l;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,n);break;case 4:u[c].fn.call(u[c].context,e,n,o);break;default:if(!_)for(p=1,_=new Array(h-1);p<h;p++)_[p-1]=arguments[p];u[c].fn.apply(u[c].context,_)}}return!0},a.prototype.on=function(t,e,r){return i(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return i(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||o&&!a.once||n&&a.context!==n||s(this,i);else{for(var _=0,c=[],u=a.length;_<u;_++)(a[_].fn!==e||o&&!a[_].once||n&&a[_].context!==n)&&c.push(a[_]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&s(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}));let Ee=class extends le{constructor({system:t,containerManager:e}){super(),this.name="Transform",this.waitRemoveIds=[],this.waitChangeScenes=[],this.containerManager=e,this.init(t)}init(t){this.system=t,this.on("changeScene",(({scene:t,mode:e,application:r})=>{this.waitChangeScenes.push({scene:t,mode:e,application:r})}))}update(){for(const t of this.waitRemoveIds)this.containerManager.removeContainer(t);this.waitRemoveIds=[];for(const t of this.waitChangeScenes){const e=this.containerManager.getContainer(t.scene.id);e&&(t.application.stage.removeChildren(),t.application.stage.addChild(e))}this.waitChangeScenes=[]}componentChanged(t){t.type===e.OBSERVER_TYPE.ADD?this.addContainer(t):t.type===e.OBSERVER_TYPE.CHANGE?this.change(t):t.type===e.OBSERVER_TYPE.REMOVE&&this.waitRemoveIds.push(t.gameObject.id)}addContainer(t){const e=new d;e.name=t.gameObject.name,this.containerManager.addContainer({name:t.gameObject.id,container:e});t.component.worldTransform=e.transform.worldTransform}change(t){const e=t.component;if(e.parent){this.containerManager.getContainer(e.parent.gameObject.id).addChild(this.containerManager.getContainer(t.gameObject.id));const r=t.gameObject.transform.parent&&t.gameObject.transform.parent.gameObject.getComponent("Render");r&&(r.sortDirty=!0)}else{const r=this.containerManager.getContainer(t.gameObject.id);delete e.worldTransform,r.parent&&r.parent.removeChild(r)}}destroy(){this.removeAllListeners(),this.waitRemoveIds=null,this.waitChangeScenes=null,this.system=null,this.containerManager=null}};Ee=n([e.decorators.componentObserver({Transform:["_parent"]})],Ee);var de=Ee;let fe;var Se=function(){function t(t,e,r){void 0===e&&(e=!1),this.next=null,this.prev=null,this.owner=null,this.fn=t,this.once=e,this.thisArg=r}return t.prototype.detach=function(){return null!==this.owner&&(this.owner.detach(this),!0)},t.prototype.dispose=function(){this.detach()},t}(),me=function(){function t(){this._head=null,this._tail=null,this._filter=null}return t.prototype.handlers=function(){for(var t=this._head,e=[];t;)e.push(t),t=t.next;return e},t.prototype.hasAny=function(){return!!this._head},t.prototype.has=function(t){return t.owner===this},t.prototype.dispatch=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this._head;if(!r)return!1;if(this._filter&&!this._filter.apply(this,t))return!1;for(;r;)r.once&&this.detach(r),r.fn.apply(r.thisArg,t),r=r.next;return!0},t.prototype.add=function(t,e){return void 0===e&&(e=null),this._addSignalBinding(new Se(t,!1,e))},t.prototype.once=function(t,e){return void 0===e&&(e=null),this._addSignalBinding(new Se(t,!0,e))},t.prototype.detach=function(t){var e=t;return e.owner!==this||(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this._head?(this._head=e.next,null===e.next&&(this._tail=null)):e===this._tail&&(this._tail=e.prev,this._tail&&(this._tail.next=null)),e.owner=null),this},t.prototype.detachAll=function(){var t=this._head;if(!t)return this;for(this._head=null,this._tail=null;t;)t.owner=null,t=t.next;return this},t.prototype.filter=function(t){this._filter=t},t.prototype.proxy=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var n=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.dispatch.apply(t,e)},o=0;o<e.length;++o)e[o].add(n);return this},t.prototype._addSignalBinding=function(t){var e=t;return this._head?(this._tail&&(this._tail.next=e),e.prev=this._tail,this._tail=e):(this._head=e,this._tail=e),e.owner=this,e},t}();var Re,Ae,Te=function(t,e){if(t){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[e.strictMode?"strict":"loose"].exec(t),o={},i=14;i--;)o[r.key[i]]=n[i]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,(function(t,e,n){e&&(o[r.q.name][e]=n)})),o}},ge=function(t){this.config=t,this.onError=new me,this.onComplete=new me,this.onProgress=new me},ye=function(t,e){return(ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Ce(t,e){function r(){this.constructor=t}ye(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function ve(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function Oe(t){var e="";if(0===t.indexOf("data:")){var r=t.indexOf("/");e=t.substring(r+1,t.indexOf(";",r))}else{var n=t.indexOf("?"),o=t.indexOf("#"),i=Math.min(n>-1?n:t.length,o>-1?o:t.length);e=(t=t.substring(0,i)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()}function Pe(t){throw new Error("Unexpected value. Should have been never.")}!function(t){t[t.Unknown=0]="Unknown",t[t.Buffer=1]="Buffer",t[t.Blob=2]="Blob",t[t.Json=3]="Json",t[t.Xml=4]="Xml",t[t.Image=5]="Image",t[t.Audio=6]="Audio",t[t.Video=7]="Video",t[t.Text=8]="Text"}(Re||(Re={})),function(t){t[t.NotStarted=0]="NotStarted",t[t.Loading=1]="Loading",t[t.Complete=2]="Complete"}(Ae||(Ae={}));var be,De=function(t){function e(e,r){var n=t.call(this,e)||this;return n.elementType=r,n._boundOnLoad=n._onLoad.bind(n),n._boundOnError=n._onError.bind(n),n._boundOnTimeout=n._onTimeout.bind(n),n._element=n._createElement(),n._elementTimer=0,n}return Ce(e,t),e.prototype.load=function(){var t=this.config;t.crossOrigin&&(this._element.crossOrigin=t.crossOrigin);var e=t.sourceSet||[t.url];if(navigator.isCocoonJS)this._element.src=e[0];else for(var r=0;r<e.length;++r){var n=e[r],o=t.mimeTypes?t.mimeTypes[r]:void 0;o||(o=this.elementType+"/"+Oe(n));var i=document.createElement("source");i.src=n,i.type=o,this._element.appendChild(i)}this._element.addEventListener("load",this._boundOnLoad,!1),this._element.addEventListener("canplaythrough",this._boundOnLoad,!1),this._element.addEventListener("error",this._boundOnError,!1),this._element.load(),t.timeout&&(this._elementTimer=window.setTimeout(this._boundOnTimeout,t.timeout))},e.prototype.abort=function(){for(this._clearEvents();this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._error(this.elementType+" load aborted by the user.")},e.prototype._createElement=function(){return this.config.loadElement?this.config.loadElement:document.createElement(this.elementType)},e.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this._element.removeEventListener("load",this._boundOnLoad,!1),this._element.removeEventListener("canplaythrough",this._boundOnLoad,!1),this._element.removeEventListener("error",this._boundOnError,!1)},e.prototype._error=function(t){this._clearEvents(),this.onError.dispatch(t)},e.prototype._complete=function(){this._clearEvents();var t=Re.Unknown;switch(this.elementType){case"audio":t=Re.Audio;break;case"video":t=Re.Video;break;default:Pe(this.elementType)}this.onComplete.dispatch(t,this._element)},e.prototype._onLoad=function(){this._complete()},e.prototype._onError=function(){this._error(this.elementType+" failed to load.")},e.prototype._onTimeout=function(){this._error(this.elementType+" load timed out.")},e}(ge),Le=function(t){function e(e){return t.call(this,e,"audio")||this}return Ce(e,t),e}(De),Me=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundOnLoad=e._onLoad.bind(e),e._boundOnError=e._onError.bind(e),e._boundOnTimeout=e._onTimeout.bind(e),e._element=e._createElement(),e._elementTimer=0,e}return Ce(e,t),e.prototype.load=function(){var t=this.config;t.crossOrigin&&(this._element.crossOrigin=t.crossOrigin),this._element.src=t.url,this._element.addEventListener("load",this._boundOnLoad,!1),this._element.addEventListener("error",this._boundOnError,!1),t.timeout&&(this._elementTimer=window.setTimeout(this._boundOnTimeout,t.timeout))},e.prototype.abort=function(){this._clearEvents(),this._element.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",this._error("Image load aborted by the user.")},e.prototype._createElement=function(){return this.config.loadElement?this.config.loadElement:document.createElement("img")},e.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this._element.removeEventListener("load",this._boundOnLoad,!1),this._element.removeEventListener("error",this._boundOnError,!1)},e.prototype._error=function(t){this._clearEvents(),this.onError.dispatch(t)},e.prototype._complete=function(){this._clearEvents(),this.onComplete.dispatch(Re.Image,this._element)},e.prototype._onLoad=function(){this._complete()},e.prototype._onError=function(){this._error("Image failed to load.")},e.prototype._onTimeout=function(){this._error("Image load timed out.")},e}(ge),xe=function(t){function e(e){return t.call(this,e,"video")||this}return Ce(e,t),e}(De),Be=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest);function Ge(t){return t.toString().replace("object ","")}!function(t){t.Default="text",t.Buffer="arraybuffer",t.Blob="blob",t.Document="document",t.Json="json",t.Text="text"}(be||(be={}));var we=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundOnLoad=e._onLoad.bind(e),e._boundOnAbort=e._onAbort.bind(e),e._boundOnError=e._onError.bind(e),e._boundOnTimeout=e._onTimeout.bind(e),e._boundOnProgress=e._onProgress.bind(e),e._xhr=e._createRequest(),e._xhrType=be.Default,e}return Ce(e,t),e.prototype.load=function(){var t=this.config,e=Oe(t.url);"string"!=typeof t.xhrType&&(t.xhrType=this._determineXhrType(e));var r=this._xhr;this._xhrType=t.xhrType||be.Default,Be?(r.timeout=t.timeout||5e3,r.onload=this._boundOnLoad,r.onerror=this._boundOnError,r.ontimeout=this._boundOnTimeout,r.onprogress=this._boundOnProgress,r.open("GET",t.url,!0),setTimeout((function(){r.send()}),0)):(r.open("GET",t.url,!0),t.timeout&&(r.timeout=t.timeout),t.xhrType===be.Json||t.xhrType===be.Document?r.responseType=be.Text:r.responseType=t.xhrType,r.addEventListener("load",this._boundOnLoad,!1),r.addEventListener("abort",this._boundOnAbort,!1),r.addEventListener("error",this._boundOnError,!1),r.addEventListener("timeout",this._boundOnTimeout,!1),r.addEventListener("progress",this._boundOnProgress,!1),r.send())},e.prototype.abort=function(){Be?(this._clearEvents(),this._xhr.abort(),this._onAbort()):this._xhr.abort()},e.prototype._createRequest=function(){return Be?new window.XDomainRequest:new XMLHttpRequest},e.prototype._determineXhrType=function(t){return e._xhrTypeMap[t]||be.Default},e.prototype._clearEvents=function(){Be?(this._xhr.onload=null,this._xhr.onerror=null,this._xhr.ontimeout=null,this._xhr.onprogress=null):(this._xhr.removeEventListener("load",this._boundOnLoad,!1),this._xhr.removeEventListener("abort",this._boundOnAbort,!1),this._xhr.removeEventListener("error",this._boundOnError,!1),this._xhr.removeEventListener("timeout",this._boundOnTimeout,!1),this._xhr.removeEventListener("progress",this._boundOnProgress,!1))},e.prototype._error=function(t){this._clearEvents(),this.onError.dispatch(t)},e.prototype._complete=function(t,e){this._clearEvents(),this.onComplete.dispatch(t,e)},e.prototype._onLoad=function(){var t=this._xhr,e="",r=void 0===t.status?200:t.status;if(void 0!==t.responseType&&""!==t.responseType&&"text"!==t.responseType||(e=t.responseText),0===r&&(e.length>0||t.responseType===be.Buffer)?r=200:1223===r&&(r=204),200===100*Math.floor(r/100))switch(this._xhrType){case be.Buffer:this._complete(Re.Buffer,t.response);break;case be.Blob:this._complete(Re.Blob,t.response);break;case be.Document:this._parseDocument(e);break;case be.Json:this._parseJson(e);break;case be.Default:case be.Text:this._complete(Re.Text,e);break;default:Pe(this._xhrType)}else this._error("["+t.status+"] "+t.statusText+": "+t.responseURL)},e.prototype._parseDocument=function(t){try{if(window.DOMParser){var e=(new DOMParser).parseFromString(t,"text/xml");this._complete(Re.Xml,e)}else{var r=document.createElement("div");r.innerHTML=t,this._complete(Re.Xml,r)}}catch(t){this._error("Error trying to parse loaded xml: "+t)}},e.prototype._parseJson=function(t){try{var e=JSON.parse(t);this._complete(Re.Json,e)}catch(t){this._error("Error trying to parse loaded json: "+t)}},e.prototype._onAbort=function(){var t=this._xhr;this._error(Ge(t)+" Request was aborted by the user.")},e.prototype._onError=function(){var t=this._xhr;this._error(Ge(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e.prototype._onTimeout=function(){var t=this._xhr;this._error(Ge(t)+" Request timed out.")},e.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(t.loaded/t.total)},e.setExtensionXhrType=function(t,r){t&&0===t.indexOf(".")&&(t=t.substring(1)),t&&(e._xhrTypeMap[t]=r)},e.ResponseType=be,e._xhrTypeMap={xhtml:be.Document,html:be.Document,htm:be.Document,xml:be.Document,tmx:be.Document,svg:be.Document,tsx:be.Document,gif:be.Blob,png:be.Blob,bmp:be.Blob,jpg:be.Blob,jpeg:be.Blob,tif:be.Blob,tiff:be.Blob,webp:be.Blob,tga:be.Blob,json:be.Json,text:be.Text,txt:be.Text,ttf:be.Buffer,otf:be.Buffer},e}(ge);function Ne(t){var e=t;return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(null===e)throw new Error("Callback was already called.");var n=e;return e=null,n.apply(this,t)}}var Ie=function(){function t(t,e){if(void 0===e&&(e=1),this.worker=t,this.concurrency=e,this.workers=0,this.buffer=0,this.paused=!1,this._started=!1,this._tasks=[],this.onSaturated=new me,this.onUnsaturated=new me,this.onEmpty=new me,this.onDrain=new me,this.onError=new me,0===e)throw new Error("Concurrency must not be zero");this.buffer=e/4}return Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.onDrain.detachAll(),this.workers=0,this._started=!1,this._tasks=[]},t.prototype.push=function(t,e){this._insert(t,!1,e)},t.prototype.unshift=function(t,e){this._insert(t,!0,e)},t.prototype.process=function(){for(;!this.paused&&this.workers<this.concurrency&&this._tasks.length;){var t=this._tasks.shift();0===this._tasks.length&&this.onEmpty.dispatch(),this.workers+=1,this.workers===this.concurrency&&this.onSaturated.dispatch(),this.worker(t.data,Ne(this._next(t)))}},t.prototype.length=function(){return this._tasks.length},t.prototype.running=function(){return this.workers},t.prototype.idle=function(){return this._tasks.length+this.workers===0},t.prototype.pause=function(){!0!==this.paused&&(this.paused=!0)},t.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var t=1;t<=this.concurrency;t++)this.process()}},t.prototype.getTask=function(t){return this._tasks[t]},t.prototype._insert=function(t,e,r){var n=this;if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(this._started=!0,null==t&&this.idle())setTimeout((function(){return n.onDrain.dispatch()}),1);else{var o={data:t,callback:r};e?this._tasks.unshift(o):this._tasks.push(o),setTimeout((function(){return n.process()}),1)}},t.prototype._next=function(t){var e=this;return function(r){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];e.workers-=1,t.callback&&t.callback.apply(t,ve([r],n)),r&&e.onError.dispatch(r,t.data),e.workers<=e.concurrency-e.buffer&&e.onUnsaturated.dispatch(),e.idle()&&e.onDrain.dispatch(),e.process()}},t}(),He=function(){function t(e,r){if(this.children=[],this.onStart=new me,this.onProgress=new me,this.onComplete=new me,this.onAfterMiddleware=new me,this.data=null,this.type=Re.Unknown,this.error="",this.progressChunk=0,this._dequeue=function(){},this._onCompleteBinding=null,this._state=Ae.NotStarted,this.name=e,this.metadata=r.metadata,"string"!=typeof r.crossOrigin&&(r.crossOrigin=this._determineCrossOrigin(r.url)),r.strategy&&"function"!=typeof r.strategy)this._strategy=r.strategy,this._strategy.config=r;else{var n=r.strategy;n||(n=t._loadStrategyMap[Oe(r.url)]),n||(n=t._defaultLoadStrategy),this._strategy=new n(r)}this._strategy.onError.add(this._error,this),this._strategy.onComplete.add(this._complete,this),this._strategy.onProgress.add(this._progress,this)}return t.setDefaultLoadStrategy=function(e){t._defaultLoadStrategy=e},t.setLoadStrategy=function(e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t._loadStrategyMap[e]=r)},Object.defineProperty(t.prototype,"strategy",{get:function(){return this._strategy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._strategy.config.url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._state===Ae.Loading},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._state===Ae.Complete},enumerable:!0,configurable:!0}),t.prototype.abort=function(){this._strategy.abort()},t.prototype.load=function(){this._state=Ae.Loading,this.onStart.dispatch(this),this._strategy.load()},t.prototype._error=function(t){this._state=Ae.Complete,this.error=t,this.onComplete.dispatch(this)},t.prototype._complete=function(t,e){this._state=Ae.Complete,this.type=t,this.data=e,this.onComplete.dispatch(this)},t.prototype._progress=function(t){this.onProgress.dispatch(this,t)},t.prototype._determineCrossOrigin=function(e,r){if(void 0===r&&(r=window.location),0===e.indexOf("data:")||0===e.indexOf("javascript:"))return"";if(window.origin!==window.location.origin)return"anonymous";t._tempAnchor||(t._tempAnchor=document.createElement("a")),t._tempAnchor.href=e;var n=Te(t._tempAnchor.href,{strictMode:!0}),o=!n.port&&""===r.port||n.port===r.port,i=n.protocol?n.protocol+":":"";return n.host===r.hostname&&o&&i===r.protocol?"":"anonymous"},t._tempAnchor=null,t._defaultLoadStrategy=we,t._loadStrategyMap={gif:Me,png:Me,bmp:Me,jpg:Me,jpeg:Me,tif:Me,tiff:Me,webp:Me,tga:Me,svg:Me,"svg+xml":Me,mp3:Le,ogg:Le,wav:Le,mp4:xe,webm:xe,mov:xe},t}();var Ue,je,Xe,ke,Ke,Ve,We,Ye,Fe,qe,ze,$e,Je,Qe,Ze,tr,er,rr,nr,or=/(#[\w-]+)?$/;!function(){function t(e,r){void 0===e&&(e=""),void 0===r&&(r=10),this.progress=0,this.loading=!1,this.defaultQueryString="",this.resources={},this.onError=new me,this.onLoad=new me,this.onStart=new me,this.onComplete=new me,this.onProgress=new me,this._baseUrl="",this._urlResolvers=[],this._middleware=[],this._resourcesParsing=[],this._boundLoadResource=this._loadResource.bind(this),this.baseUrl=e,this._queue=new Ie(this._boundLoadResource,r),this._queue.pause(),this._middleware=t._defaultMiddleware.slice()}Object.defineProperty(t.prototype,"baseUrl",{get:function(){return this._baseUrl},set:function(t){for(;t.length&&"/"===t.charAt(t.length-1);)t=t.slice(0,-1);this._baseUrl=t},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){if(Array.isArray(t)){for(var r=0;r<t.length;++r)this.add(t[r]);return this}var n="",o="",i=this._baseUrl,s={url:""};if("object"==typeof t?(n=t.url,o=t.name||t.url,i=t.baseUrl||i,s=t):(o=t,n="string"==typeof e?e:o),!n)throw new Error("You must specify the `url` property.");if(this.loading&&!s.parentResource)throw new Error("Cannot add root resources while the loader is running.");if(this.resources[o])throw new Error('Resource named "'+o+'" already exists.');n=this._prepareUrl(n,i),s.url=n;var a=new He(o,s);if(this.resources[o]=a,"function"==typeof s.onComplete&&a.onAfterMiddleware.once(s.onComplete),this.loading){var _=s.parentResource,c=[];for(r=0;r<_.children.length;++r)_.children[r].isComplete||c.push(_.children[r]);var u=_.progressChunk*(c.length+1)/(c.length+2);_.children.push(a),_.progressChunk=u;for(r=0;r<c.length;++r)c[r].progressChunk=u;a.progressChunk=u}return this._queue.push(a),this},t.prototype.use=function(e,r){return void 0===r&&(r=t.DefaultMiddlewarePriority),this._middleware.push({fn:e,priority:r}),this._middleware.sort((function(t,e){return t.priority-e.priority})),this},t.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.reset(),this._queue.pause(),this.resources){var e=this.resources[t];e&&(e._onCompleteBinding&&e._onCompleteBinding.detach(),e.isLoading&&e.abort())}return this.resources={},this},t.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue.length(),r=0;r<this._queue.length();++r)this._queue.getTask(r).data.progressChunk=e;this._onStart(),this._queue.resume()}return this},Object.defineProperty(t.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t},enumerable:!0,configurable:!0}),t.prototype.addUrlResolver=function(t){return this._urlResolvers.push(t),this},t.prototype._prepareUrl=function(t,e){var r=Te(t,{strictMode:!0});if(this._urlResolvers.forEach((function(e){t=e(t,r),r=Te(t,{strictMode:!0})})),r.protocol||0===t.indexOf("//")||(t=e.length&&"/"!==t.charAt(0)?e+"/"+t:e+t),this.defaultQueryString){var n=or.exec(t);if(n){var o=n[0];-1!==(t=t.substr(0,t.length-o.length)).indexOf("?")?t+="&"+this.defaultQueryString:t+="?"+this.defaultQueryString,t+=o}}return t},t.prototype._loadResource=function(t,e){t._dequeue=e,t._onCompleteBinding=t.onComplete.once(this._onLoad,this),t.load()},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(t){var e=this;t._onCompleteBinding=null,this._resourcesParsing.push(t),t._dequeue(),function(t,e,r,n){void 0===n&&(n=!1);var o=0,i=t.length;!function s(a){a||o===i?r&&r(a):n?setTimeout((function(){return e(t[o++],s)}),1):e(t[o++],s)}()}(this._middleware,(function(r,n){r.fn.call(e,t,n)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},t.use=function(e,r){return void 0===r&&(r=t.DefaultMiddlewarePriority),t._defaultMiddleware.push({fn:e,priority:r}),t._defaultMiddleware.sort((function(t,e){return t.priority-e.priority})),t},t.DefaultMiddlewarePriority=50,t._defaultMiddleware=[]}(),function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Ue||(Ue={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(je||(je={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Xe||(Xe={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(ke||(ke={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ke||(Ke={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Ve||(Ve={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(We||(We={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Ye||(Ye={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(Fe||(Fe={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(qe||(qe={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(ze||(ze={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}($e||($e={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(Je||(Je={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(Qe||(Qe={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Ze||(Ze={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(tr||(tr={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(er||(er={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(rr||(rr={})),function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=3781]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR"}(nr||(nr={}));const ir={[nr.COMPRESSED_RGB_S3TC_DXT1_EXT]:.5,[nr.COMPRESSED_RGBA_S3TC_DXT1_EXT]:.5,[nr.COMPRESSED_RGBA_S3TC_DXT3_EXT]:1,[nr.COMPRESSED_RGBA_S3TC_DXT5_EXT]:1,[nr.COMPRESSED_SRGB_S3TC_DXT1_EXT]:.5,[nr.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:.5,[nr.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:1,[nr.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:1,[nr.COMPRESSED_R11_EAC]:.5,[nr.COMPRESSED_SIGNED_R11_EAC]:.5,[nr.COMPRESSED_RG11_EAC]:1,[nr.COMPRESSED_SIGNED_RG11_EAC]:1,[nr.COMPRESSED_RGB8_ETC2]:.5,[nr.COMPRESSED_RGBA8_ETC2_EAC]:1,[nr.COMPRESSED_SRGB8_ETC2]:.5,[nr.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:1,[nr.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:.5,[nr.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:.5,[nr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:.5,[nr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:.5,[nr.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:.25,[nr.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:.25,[nr.COMPRESSED_RGB_ETC1_WEBGL]:.5,[nr.COMPRESSED_RGB_ATC_WEBGL]:.5,[nr.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]:1,[nr.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]:1,[nr.COMPRESSED_RGBA_ASTC_4x4_KHR]:1,[nr.COMPRESSED_RGBA_ASTC_5x5_KHR]:.64,[nr.COMPRESSED_RGBA_ASTC_6x6_KHR]:.445,[nr.COMPRESSED_RGBA_ASTC_8x8_KHR]:.25,[nr.COMPRESSED_RGBA_ASTC_10x10_KHR]:.16,[nr.COMPRESSED_RGBA_ASTC_12x12_KHR]:.11125};class sr{upload(t){const{levels:e}=this;for(var r=0;r<this.levels;++r){let{levelWidth:e,levelHeight:n,levelBuffer:o}=this.levelBuffers[r];t.compressedTexImage2D(t.TEXTURE_2D,r,this.internalFormat,e,n,0,o)}e>1?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))}}const ar={[Ye.UNSIGNED_BYTE]:1,[Ye.UNSIGNED_SHORT]:2,[Ye.FLOAT]:4,[Ye.HALF_FLOAT]:8},_r={[Ve.RGBA]:4,[Ve.RGB]:3,[Ve.LUMINANCE]:1,[Ve.LUMINANCE_ALPHA]:2,[Ve.ALPHA]:1},cr={[Ye.UNSIGNED_SHORT_4_4_4_4]:2,[Ye.UNSIGNED_SHORT_5_5_5_1]:2,[Ye.UNSIGNED_SHORT_5_6_5]:2},ur=12,hr=16,pr=24,lr=28,Er=36,dr=40,fr=44,Sr=48,mr=52,Rr=56,Ar=60,Tr=[171,75,84,88,32,49,49,187,13,10,26,10];class gr extends sr{constructor(t,e){super(),this.src=e,this.complete=!0;const r=new DataView(t);if(!function(t){for(let e=0;e<Tr.length;e++)if(t.getUint8(e)!==Tr[e])return!1;return!0}(r))throw new Error("Not a valid KTX Texture");const n=67305985===r.getUint32(ur,!0),o=r.getUint32(hr,n),i=r.getUint32(pr,n),s=this.internalFormat=r.getUint32(lr,n),a=this.width=r.getUint32(Er,n),_=this.height=r.getUint32(dr,n)||1,c=r.getUint32(fr,n)||1,u=r.getUint32(Sr,n)||1,h=r.getUint32(mr,n),p=this.levels=r.getUint32(Rr,n),l=r.getUint32(Ar,n);if(0===_||1!==c)throw new Error("Only 2D textures are supported");if(1!==h)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const E=a+3&-4,d=_+3&-4,f=new Array(u);let S,m=a*_;if(0===o&&(m=E*d),S=0!==o?ar[o]?ar[o]*_r[i]:cr[o]:ir[s],void 0===S)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let R=m*S,A=a,T=_,g=E,y=d,C=64+l;for(let e=0;e<p;e++){const o=r.getUint32(C,n);let i=C+4;for(let r=0;r<u;r++){let n=f[r];n||(n=f[r]=new Array(p)),n[e]={levelID:e,levelWidth:p>1?A:g,levelHeight:p>1?T:y,levelBuffer:new Uint8Array(t,i,R)},i+=R}C+=o+4,C=C%4!=0?C+4-C%4:C,A=A>>1||1,T=T>>1||1,g=A+4-1&-4,y=T+4-1&-4,R=g*y*S}if(0!==o)throw new Error("TODO: Uncompressed");this.levelBuffers=f[0]}}class yr extends we{_complete(t,e){super._complete(t,new gr(e,this.config.url))}}const Cr={uploadNotCompressed:r.glCore.GLTexture.prototype.upload,isCompressed:!1,upload:function(t){if(!(t instanceof sr))return this.uploadNotCompressed(t);this.bind();var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.isCompressed=!0,t.upload(e)},enableMipmap:function(){if(!this.isCompressed){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_2D)}}},vr=Symbol(),Or={[vr]:r.Texture.from,from(t){return t instanceof sr?new r.Texture(r.BaseTexture.from(t)):this[vr](t)}},Pr=Symbol(),br={[Pr]:r.BaseTexture.from,from(t,e,n){if(!(t instanceof sr))return this[Pr](t,e,n);const o=t.src;let i=r.utils.BaseTextureCache[o];return i||(i=new r.BaseTexture(t,e),i.imageUrl=o,n&&(i.sourceScale=n),r.BaseTexture.addToCache(i,o)),i}};var Dr;e.resource.addPreProcessResourceHandler((function(t){var e,r;const n=null===(r=null===(e=t.src)||void 0===e?void 0:e.image)||void 0===r?void 0:r.texture;if(!n)return;const{extensions:o,textureFormats:i,formats:s}=function(){if(fe)return fe;const t=document.createElement("canvas").getContext("webgl");if(!t)return void console.warn("WebGL not available for compressed textures. Silently failing.");const e={s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")},r={};for(const t in e){const n=e[t];n&&Object.assign(r,Object.getPrototypeOf(n))}let n=Object.values(r);return fe={extensions:e,textureFormats:r,formats:n},fe}();let a=n.find((t=>o[t.type]&&(s.includes(t.internalFormat)||i[t.internalFormat])));a&&(t.src.image.url=a.url,t.src.image.type=a.type)})),Object.assign(e.STRATEGY,{astc:yr,etc:yr,pvrtc:yr,s3tc:yr,atc:yr}),yr.setExtensionXhrType("ktx",be.Buffer),Object.assign(r.glCore.GLTexture.prototype,Cr),Object.assign(r.Texture,Or),Object.assign(r.BaseTexture,br),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Dr||(Dr={}));const Lr=t=>{t.plugins.interaction.autoPreventDefault=!0,t.view.style.touchAction="none"},Mr=t=>{t.plugins.interaction.autoPreventDefault=!1,t.view.style.touchAction="auto"};let xr=class extends e.System{constructor(){super(...arguments),this.multiApps=[]}init(t){this.params=t,this.application=this.createApplication(t),this.containerManager=new pe,this.rendererManager=new he({game:this.game,rendererSystem:this}),this.game.canvas=this.application.view,this.transform=new de({system:this,containerManager:this.containerManager}),this.game.on("sceneChanged",(({scene:t,mode:r,params:n})=>{let o;switch(r){case e.LOAD_SCENE_MODE.SINGLE:o=this.application;break;case e.LOAD_SCENE_MODE.MULTI_CANVAS:o=this.createMultiApplication({params:n})}t.canvas=o.view,this.transform.emit("changeScene",{scene:t,mode:r,application:o})})),!1!==t.useCompressedTexture&&function(t){try{const e=t.renderer.gl;e.getExtension("WEBGL_compressed_texture_s3tc"),e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),e.getExtension("WEBGL_compressed_texture_etc"),e.getExtension("WEBGL_compressed_texture_etc1"),e.getExtension("WEBGL_compressed_texture_pvrtc"),e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),e.getExtension("WEBGL_compressed_texture_atc"),e.getExtension("WEBGL_compressed_texture_astc")}catch(t){console.error("Compressed texture ability failure ! The message is :",t.message)}}(this.application)}registerObserver(t){const e=this.constructor.observerInfo;for(const r in t)e[r]||(e[r]=[]),e[r].push(...t[r])}createMultiApplication({params:t}){const e=this.createApplication(t);return this.multiApps.push(e),e}createApplication(t){t.view=t.canvas,t.renderType===Dr.CANVAS&&(t.forceCanvas=!0),r.ticker.shared.autoStart=!1,r.ticker.shared.stop();const e=new E(Object.assign({sharedTicker:!0},t));return void 0!==t.preventScroll&&(console.warn("PreventScroll property will deprecate at next major version, please use enableEnable instead. https://eva.js.org/#/tutorials/game"),t.preventScroll?Mr(e.renderer):Lr(e.renderer)),void 0!==t.enableScroll&&(t.enableScroll?Mr(e.renderer):Lr(e.renderer)),void 0===t.preventScroll&&void 0===t.enableScroll&&Mr(e.renderer),e}update(){const t=this.componentObserver.clear();for(const e of t)this.transform.componentChanged(e);for(const t of this.game.gameObjects)this.containerManager.updateTransform({name:t.id,transform:t.transform}),this.rendererManager.update(t)}lateUpdate(t){this.transform.update(),this.application.ticker.update(t.time)}onDestroy(){this.application.destroy();for(const t of this.multiApps)t&&t.destroy();this.transform.destroy(),this.transform=null,this.params=null,this.rendererManager=null,this.containerManager=null,this.application=null,this.game=null,this.multiApps=null}resize(t,e){this.params.width=t,this.params.height=e,this.application.renderer.resize(t,e)}};xr.systemName="Renderer",xr=n([e.decorators.componentObserver({Transform:["_parent"]})],xr);var Br=xr;const Gr=["hint","event","delay","attr","role","props","state","a11yId","name"],wr=function(t,e,r){["touchstart","touchend","tap"].forEach((n=>{t.emit(n,{stopPropagation:()=>r.stopPropagation(),data:{position:this.eventPosition},gameObject:e})}))};let Nr=class extends e.System{constructor(t){super(t),this.cache=new Map,this.eventCache=new Map}get ratioX(){if(this._ratioX)return this._ratioX;return this.setRatio()?this._ratioX:0}get ratioY(){if(this._ratioY)return this._ratioY;return this.setRatio()?this._ratioY:0}init(e={}){return o(this,void 0,void 0,(function*(){const{activate:r=t.A11yActivate.CHECK,delay:n=100,checkA11yOpen:o=(()=>Promise.resolve(!1))}=e;switch(this.delay=n,r){case t.A11yActivate.CHECK:try{this.activate=yield o()}catch(t){this.activate=!1}break;case t.A11yActivate.DISABLE:this.activate=!1;break;case t.A11yActivate.ENABLE:this.activate=!0}if(this.debug=e.debug||!1,this.debug&&(this.activate=!0),!this.activate)return;const i=document.createElement("div");this.div=i,this.game.canvas.parentNode&&this.game.canvas.parentNode.appendChild(this.div)}))}setRatio(){const{width:t,height:e}=this.getCanvasBoundingClientRect(),{renderWidth:r,renderHeight:n}=this.getRenderRect();return this._ratioX=t/r,this._ratioY=e/n,!(!t&&!e)&&(this.initDiv(),!0)}getRenderRect(){const{params:t}=this.game.getSystem(Br)||{width:300,height:300},{height:e,width:r}=t;return{renderWidth:r,renderHeight:e}}getCanvasBoundingClientRect(){const{width:t,height:e,left:r,top:n}=this.game.canvas.getBoundingClientRect();return{width:t,height:e,left:r,top:n}}initDiv(){const{pageXOffset:t,pageYOffset:e}=window,{width:r,height:n,left:o,top:s}=this.getCanvasBoundingClientRect(),_={width:r,height:n,left:`${o+t}px`,top:`${s+e}px`,position:a,zIndex:3,pointerEvents:c.NONE,background:u.NONE};i(this.div,_),this.div.addEventListener("click",(t=>{const e=t.currentTarget,{left:r,top:n}=e.getBoundingClientRect(),o=(t.pageX-r)/this.ratioX,i=(t.pageY-n)/this.ratioY;this.eventPosition={x:o,y:i}}),!0)}update(){return o(this,void 0,void 0,(function*(){const t=this.componentObserver.clear();if(this.activate)for(const r of t)switch(r.type){case e.OBSERVER_TYPE.ADD:"Event"===r.componentName&&this.addEvent(r.gameObject),"A11y"===r.componentName&&this.add(r);break;case e.OBSERVER_TYPE.CHANGE:"Transform"===r.componentName&&this.transformChange(r);break;case e.OBSERVER_TYPE.REMOVE:"Event"===r.componentName&&this.removeEvent(r),"A11y"===r.componentName&&this.remove(r)}}))}remove(t){const e=t.component;if(!e)return;const{a11yId:r}=e,n=this.div.querySelector(`#${r}`);n&&this.div.removeChild(n),this.cache.delete(r)}add(t){if(!this.activate)return;const e=t.component,{gameObject:r}=t,{delay:n,a11yId:o}=e;let{event:i}=e;if(!r)return;const{transform:s}=r;if(!s)return;const a=document.createElement("div");this.cache.set(o,a),i||(i=r.getComponent("Event")),setTimeout((()=>{this.setPosition(a,s),this.setA11yAttr(a,e),i&&this.addEvent(r),r.scene&&this.div.appendChild(a)}),n||this.delay)}transformChange(t){const e=t.component,{gameObject:r}=t,n=r.getComponent(s);if(!n)return;const{a11yId:o}=n;if(e.inScene){if(this.cache.has(o)){const t=this.cache.get(o);t&&this.div.appendChild(t)}}else{const t=this.div.querySelector(`#${o}`);t&&this.div.removeChild(t)}}setEvent(t,e,r,n){if(!e)return;const o=wr.bind(this,e,r);this.eventCache.set(n,o),t.addEventListener("click",o)}addEvent(t){const e=t.getComponent(s);if(!e)return;const r=t.getComponent("Event");if(!r)return;const n=this.cache.get(e.a11yId);n&&this.setEvent(n,r,t,e.a11yId)}removeEvent(t){const{gameObject:e}=t,r=e.getComponent(s);if(!r)return;if(!t.component)return;const{a11yId:n}=r,o=this.eventCache.get(n),i=this.cache.get(n);i&&i.removeEventListener("click",o)}setA11yAttr(t,e){const{hint:r,props:n={},state:o={},role:i,a11yId:s}=e,a=i||"text";t.setAttribute("role",a),t.setAttribute("aria-label",r),t.id=s;const _=Object.keys(n);for(const e of _)t.setAttribute(e,n[e]);const c=Object.keys(o);for(const e of c)t.setAttribute(e,o[e]);for(let r of Object.keys(e))"string"==typeof e[r]&&-1===Gr.indexOf(r)&&1!==r.indexOf("_")&&t.setAttribute(r,e[r])}setPosition(t,e){const{width:r,height:n}=e.size,o={width:0===r?1:r*this.ratioX,height:0===n?1:n*this.ratioY,position:a,zIndex:3,pointerEvents:c.AUTO,background:this.debug?u.DEBUG:u.NONE},s=Object.assign({},e);i(t,o),((t,e,r,n)=>{const{worldTransform:o}=e,{a:i,b:s,c:a,d:_,tx:c,ty:u}=o,h=`matrix(${i}, ${s}, ${a}, ${_}, ${c*r}, ${u*n})`;t.style.transform=`${h}`,t.style.webkitTransform=`${h}`,t.style.transformOrigin="left top",t.style.webkitTransformOrigin="left top"})(t,s,this.ratioX,this.ratioY)}onDestroy(){this.div.parentElement.removeChild(this.div),this.cache=null,this.eventCache=null}};Nr.systemName="A11ySystem",Nr=n([e.decorators.componentObserver({A11y:[],Transform:["inScene"],Event:[]})],Nr);var Ir=Nr;t.A11y=s,t.A11ySystem=Ir,Object.defineProperty(t,"__esModule",{value:!0})}));
