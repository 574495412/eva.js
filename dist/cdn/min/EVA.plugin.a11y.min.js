!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@eva/eva.js"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","pixi.js"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).EVA=t.EVA||{},t.EVA.plugin=t.EVA.plugin||{},t.EVA.plugin.a11y={}),t.EVA,t.PIXI)}(this,(function(t,e,n){"use strict";function r(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function o(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))}const i=(t,e)=>{const{width:n,height:r,position:o,left:i=0,top:a=0,zIndex:s,pointerEvents:c,background:u}=e;t.style.width=`${n}px`,t.style.height=`${r}px`,t.style.position=o,t.style.left=`${i}`,t.style.top=`${a}`,t.style.zIndex=`${s}`,t.style.pointerEvents=c,t.style.background=u,t.style.border="none",t.style.overflow="hidden"};class a extends e.Component{constructor(t){super(),Object.assign(this,t);const{hint:e="",event:n,delay:r=0,attr:o={},role:i="",props:a={},state:s={}}=t;this.hint=e,this.event=n,this.delay=r,this.attr=o,this.role=i,this.props=a,this.state=s,this.a11yId=`_${function(t){let e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],r=e.length;for(let o=0;o<t;o++)n[o]=e[0|Math.random()*r];return n.join("")}(6)}`}}a.componentName="A11y",r([e.decorators.IDEProp],a.prototype,"interactive",void 0),r([e.decorators.IDEProp],a.prototype,"hint",void 0),r([e.decorators.IDEProp],a.prototype,"event",void 0),r([e.decorators.IDEProp],a.prototype,"delay",void 0),r([e.decorators.IDEProp],a.prototype,"role",void 0),r([e.decorators.IDEProp],a.prototype,"props",void 0),r([e.decorators.IDEProp],a.prototype,"state",void 0),r([e.decorators.IDEProp],a.prototype,"attr",void 0),r([e.decorators.IDEProp],a.prototype,"a11yId",void 0);const s="absolute";var c,u,p,h;t.A11yActivate=void 0,(c=t.A11yActivate||(t.A11yActivate={}))[c.ENABLE=0]="ENABLE",c[c.DISABLE=1]="DISABLE",c[c.CHECK=2]="CHECK",function(t){t.NONE="none",t.AUTO="auto"}(u||(u={})),function(t){t.DEBUG="rgba(255,0,0,0.5)",t.NONE="transparent"}(p||(p={})),function(t){t.BUTTON="button",t.DIV="div"}(h||(h={}));var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function f(t,e){function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var d=function(t){function e(e){return e.autoStart=!1,t.call(this,e)||this}return f(e,t),e}(n.Application),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e}(n.Container);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}f(e,t)}(n.Graphics),function(t){function e(e,r,o,i,a){var s;return s="string"===e?n.Texture.fromFrame(e):n.Texture.from(e),t.call(this,s,r,o,i,a)||this}f(e,t)}(n.mesh.NineSlicePlane),function(){function t(t){this._image=null,this._image=t,t?t instanceof HTMLImageElement?this.sprite=n.Sprite.from(t):t instanceof n.Texture&&(this.sprite=new n.Sprite(t)):this.sprite=new n.Sprite}Object.defineProperty(t.prototype,"image",{get:function(){return this._image},set:function(t){this._image!==t&&(t instanceof HTMLImageElement?(this.sprite.texture&&this.sprite.texture.destroy(!1),this.sprite.texture=n.Texture.from(t)):t instanceof n.Texture&&(this.sprite.texture=t),this._image=t)},enumerable:!1,configurable:!0})}(),function(){function t(t){var e=t.frames;this.animatedSprite=new n.extras.AnimatedSprite(e)}t.prototype.play=function(){this.animatedSprite.play()},t.prototype.stop=function(){this.animatedSprite.stop()},t.prototype.gotoAndPlay=function(t){this.animatedSprite.gotoAndPlay(t)},t.prototype.gotoAndStop=function(t){this.animatedSprite.gotoAndStop(t)},Object.defineProperty(t.prototype,"speed",{get:function(){return this.animatedSprite.animationSpeed},set:function(t){this.animatedSprite.animationSpeed=t},enumerable:!1,configurable:!0})}(),function(t){function e(e,n){return t.call(this,e,n)||this}f(e,t)}(n.Text);var y=n.extras.TilingSprite;function m(t,e){return t===e||t!=t&&e!=e}function g(t,e){for(var n=t.length;n--;)if(m(t[n][0],e))return n;return-1}!function(){function t(t){this._image=null,this._image=t,t?t instanceof HTMLImageElement?this.tilingSprite=new y(n.Texture.from(t)):t instanceof n.Texture&&(this.tilingSprite=new y(t)):this.tilingSprite=new y(n.Texture.EMPTY)}Object.defineProperty(t.prototype,"image",{get:function(){return this._image},set:function(t){this._image!==t&&(t instanceof HTMLImageElement?this.tilingSprite.texture=n.Texture.from(t):t instanceof n.Texture&&(this.tilingSprite.texture=t),this._image=t)},enumerable:!1,configurable:!0})}();var b=Array.prototype.splice;function _(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}_.prototype.clear=function(){this.__data__=[],this.size=0},_.prototype.delete=function(t){var e=this.__data__,n=g(e,t);return!(n<0)&&(n==e.length-1?e.pop():b.call(e,n,1),--this.size,!0)},_.prototype.get=function(t){var e=this.__data__,n=g(e,t);return n<0?void 0:e[n][1]},_.prototype.has=function(t){return g(this.__data__,t)>-1},_.prototype.set=function(t,e){var n=this.__data__,r=g(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var j="object"==typeof global&&global&&global.Object===Object&&global,O="object"==typeof self&&self&&self.Object===Object&&self,E=j||O||Function("return this")(),w=E.Symbol,A=Object.prototype,S=A.hasOwnProperty,C=A.toString,x=w?w.toStringTag:void 0;var P=Object.prototype.toString;var T=w?w.toStringTag:void 0;function M(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":T&&T in Object(t)?function(t){var e=S.call(t,x),n=t[x];try{t[x]=void 0;var r=!0}catch(t){}var o=C.call(t);return r&&(e?t[x]=n:delete t[x]),o}(t):function(t){return P.call(t)}(t)}function I(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function N(t){if(!I(t))return!1;var e=M(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var R,D=E["__core-js_shared__"],k=(R=/[^.]+$/.exec(D&&D.keys&&D.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"";var z=Function.prototype.toString;function B(t){if(null!=t){try{return z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var L=/^\[object .+?Constructor\]$/,$=Function.prototype,V=Object.prototype,Y=$.toString,U=V.hasOwnProperty,H=RegExp("^"+Y.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function X(t){return!(!I(t)||(e=t,k&&k in e))&&(N(t)?H:L).test(B(t));var e}function F(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return X(n)?n:void 0}var G=F(E,"Map"),W=F(Object,"create");var q=Object.prototype.hasOwnProperty;var K=Object.prototype.hasOwnProperty;function J(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Q(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function Z(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}J.prototype.clear=function(){this.__data__=W?W(null):{},this.size=0},J.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},J.prototype.get=function(t){var e=this.__data__;if(W){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return q.call(e,t)?e[t]:void 0},J.prototype.has=function(t){var e=this.__data__;return W?void 0!==e[t]:K.call(e,t)},J.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=W&&void 0===e?"__lodash_hash_undefined__":e,this},Z.prototype.clear=function(){this.size=0,this.__data__={hash:new J,map:new(G||_),string:new J}},Z.prototype.delete=function(t){var e=Q(this,t).delete(t);return this.size-=e?1:0,e},Z.prototype.get=function(t){return Q(this,t).get(t)},Z.prototype.has=function(t){return Q(this,t).has(t)},Z.prototype.set=function(t,e){var n=Q(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function tt(t){var e=this.__data__=new _(t);this.size=e.size}tt.prototype.clear=function(){this.__data__=new _,this.size=0},tt.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},tt.prototype.get=function(t){return this.__data__.get(t)},tt.prototype.has=function(t){return this.__data__.has(t)},tt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof _){var r=n.__data__;if(!G||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Z(r)}return n.set(t,e),this.size=n.size,this};function et(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Z;++e<n;)this.add(t[e])}function nt(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}et.prototype.add=et.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},et.prototype.has=function(t){return this.__data__.has(t)};function rt(t,e,n,r,o,i){var a=1&n,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;var u=i.get(t),p=i.get(e);if(u&&p)return u==e&&p==t;var h=-1,l=!0,f=2&n?new et:void 0;for(i.set(t,e),i.set(e,t);++h<s;){var d=t[h],v=e[h];if(r)var y=a?r(v,d,h,e,t,i):r(d,v,h,t,e,i);if(void 0!==y){if(y)continue;l=!1;break}if(f){if(!nt(e,(function(t,e){if(a=e,!f.has(a)&&(d===t||o(d,t,n,r,i)))return f.push(e);var a}))){l=!1;break}}else if(d!==v&&!o(d,v,n,r,i)){l=!1;break}}return i.delete(t),i.delete(e),l}var ot=E.Uint8Array;function it(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function at(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var st=w?w.prototype:void 0,ct=st?st.valueOf:void 0;var ut=Array.isArray;var pt=Object.prototype.propertyIsEnumerable,ht=Object.getOwnPropertySymbols,lt=ht?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}(ht(t),(function(e){return pt.call(t,e)})))}:function(){return[]};function ft(t){return null!=t&&"object"==typeof t}function dt(t){return ft(t)&&"[object Arguments]"==M(t)}var vt=Object.prototype,yt=vt.hasOwnProperty,mt=vt.propertyIsEnumerable,gt=dt(function(){return arguments}())?dt:function(t){return ft(t)&&yt.call(t,"callee")&&!mt.call(t,"callee")};var bt="object"==typeof t&&t&&!t.nodeType&&t,_t=bt&&"object"==typeof module&&module&&!module.nodeType&&module,jt=_t&&_t.exports===bt?E.Buffer:void 0,Ot=(jt?jt.isBuffer:void 0)||function(){return!1},Et=/^(?:0|[1-9]\d*)$/;function wt(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Et.test(t))&&t>-1&&t%1==0&&t<e}function At(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var St={};St["[object Float32Array]"]=St["[object Float64Array]"]=St["[object Int8Array]"]=St["[object Int16Array]"]=St["[object Int32Array]"]=St["[object Uint8Array]"]=St["[object Uint8ClampedArray]"]=St["[object Uint16Array]"]=St["[object Uint32Array]"]=!0,St["[object Arguments]"]=St["[object Array]"]=St["[object ArrayBuffer]"]=St["[object Boolean]"]=St["[object DataView]"]=St["[object Date]"]=St["[object Error]"]=St["[object Function]"]=St["[object Map]"]=St["[object Number]"]=St["[object Object]"]=St["[object RegExp]"]=St["[object Set]"]=St["[object String]"]=St["[object WeakMap]"]=!1;var Ct,xt="object"==typeof t&&t&&!t.nodeType&&t,Pt=xt&&"object"==typeof module&&module&&!module.nodeType&&module,Tt=Pt&&Pt.exports===xt&&j.process,Mt=function(){try{var t=Pt&&Pt.require&&Pt.require("util").types;return t||Tt&&Tt.binding&&Tt.binding("util")}catch(t){}}(),It=Mt&&Mt.isTypedArray,Nt=It?(Ct=It,function(t){return Ct(t)}):function(t){return ft(t)&&At(t.length)&&!!St[M(t)]},Rt=Object.prototype.hasOwnProperty;function Dt(t,e){var n=ut(t),r=!n&&gt(t),o=!n&&!r&&Ot(t),i=!n&&!r&&!o&&Nt(t),a=n||r||o||i,s=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=s.length;for(var u in t)!e&&!Rt.call(t,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||wt(u,c))||s.push(u);return s}var kt=Object.prototype;var zt=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object),Bt=Object.prototype.hasOwnProperty;function Lt(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||kt))return zt(t);var e,n,r=[];for(var o in Object(t))Bt.call(t,o)&&"constructor"!=o&&r.push(o);return r}function $t(t){return null!=(e=t)&&At(e.length)&&!N(e)?Dt(t):Lt(t);var e}function Vt(t){return function(t,e,n){var r=e(t);return ut(t)?r:function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}(r,n(t))}(t,$t,lt)}var Yt=Object.prototype.hasOwnProperty;var Ut=F(E,"DataView"),Ht=F(E,"Promise"),Xt=F(E,"Set"),Ft=F(E,"WeakMap"),Gt="[object Map]",Wt="[object Promise]",qt="[object Set]",Kt="[object WeakMap]",Jt="[object DataView]",Qt=B(Ut),Zt=B(G),te=B(Ht),ee=B(Xt),ne=B(Ft),re=M;(Ut&&re(new Ut(new ArrayBuffer(1)))!=Jt||G&&re(new G)!=Gt||Ht&&re(Ht.resolve())!=Wt||Xt&&re(new Xt)!=qt||Ft&&re(new Ft)!=Kt)&&(re=function(t){var e=M(t),n="[object Object]"==e?t.constructor:void 0,r=n?B(n):"";if(r)switch(r){case Qt:return Jt;case Zt:return Gt;case te:return Wt;case ee:return qt;case ne:return Kt}return e});var oe=re,ie="[object Arguments]",ae="[object Array]",se="[object Object]",ce=Object.prototype.hasOwnProperty;function ue(t,e,n,r,o,i){var a=ut(t),s=ut(e),c=a?ae:oe(t),u=s?ae:oe(e),p=(c=c==ie?se:c)==se,h=(u=u==ie?se:u)==se,l=c==u;if(l&&Ot(t)){if(!Ot(e))return!1;a=!0,p=!1}if(l&&!p)return i||(i=new tt),a||Nt(t)?rt(t,e,n,r,o,i):function(t,e,n,r,o,i,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new ot(t),new ot(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return m(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=it;case"[object Set]":var c=1&r;if(s||(s=at),t.size!=e.size&&!c)return!1;var u=a.get(t);if(u)return u==e;r|=2,a.set(t,e);var p=rt(s(t),s(e),r,o,i,a);return a.delete(t),p;case"[object Symbol]":if(ct)return ct.call(t)==ct.call(e)}return!1}(t,e,c,n,r,o,i);if(!(1&n)){var f=p&&ce.call(t,"__wrapped__"),d=h&&ce.call(e,"__wrapped__");if(f||d){var v=f?t.value():t,y=d?e.value():e;return i||(i=new tt),o(v,y,n,r,i)}}return!!l&&(i||(i=new tt),function(t,e,n,r,o,i){var a=1&n,s=Vt(t),c=s.length;if(c!=Vt(e).length&&!a)return!1;for(var u=c;u--;){var p=s[u];if(!(a?p in e:Yt.call(e,p)))return!1}var h=i.get(t),l=i.get(e);if(h&&l)return h==e&&l==t;var f=!0;i.set(t,e),i.set(e,t);for(var d=a;++u<c;){var v=t[p=s[u]],y=e[p];if(r)var m=a?r(y,v,p,e,t,i):r(v,y,p,t,e,i);if(!(void 0===m?v===y||o(v,y,n,r,i):m)){f=!1;break}d||(d="constructor"==p)}if(f&&!d){var g=t.constructor,b=e.constructor;g==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(f=!1)}return i.delete(t),i.delete(e),f}(t,e,n,r,o,i))}function pe(t,e,n,r,o){return t===e||(null==t||null==e||!ft(t)&&!ft(e)?t!=t&&e!=e:ue(t,e,n,r,pe,o))}class he{constructor({game:t,rendererSystem:e}){this.renderers=[],this.game=t,this.rendererSystem=e}register(...t){for(const e of t)e.game=this.game,e.rendererManager=this.rendererSystem.rendererManager,e.containerManager=this.rendererSystem.containerManager,this.renderers.push(e)}componentChanged(t){for(const n of t)for(const t of this.renderers){const r=t.observerInfo[n.componentName];if(r){if([e.OBSERVER_TYPE.ADD,e.OBSERVER_TYPE.REMOVE].indexOf(n.type)>-1){try{t.componentChanged&&t.componentChanged(n)}catch(t){console.error(`gameObject: ${n.gameObject.name}, ${n.componentName} is error.`,n,t)}continue}if(r.findIndex((t=>{return e=t,r=n.prop,pe(e,r);var e,r}))>-1)try{t.componentChanged&&t.componentChanged(n)}catch(t){console.error(`gameObject: ${n.gameObject&&n.gameObject.name}, ${n.componentName} is componentChanged error.`,n,t)}}}}update(t){for(const e of t.components)for(const n of this.renderers){const r=[];if(n.observerInfo[e.name]&&-1===r.indexOf(t)){r.push(t);try{n.rendererUpdate&&n.rendererUpdate(t)}catch(n){console.info(`gameObject: ${t.name}, ${e.name} is update error`,n)}}}}}class le{constructor(){this.containerMap={}}addContainer({name:t,container:e}){this.containerMap[t]=e}getContainer(t){return this.containerMap[t]}removeContainer(t){var e;null===(e=this.containerMap[t])||void 0===e||e.destroy(!0),delete this.containerMap[t]}updateTransform({name:t,transform:e}){const n=this.containerMap[t];if(!n)return;const{anchor:r,origin:o,position:i,rotation:a,scale:s,size:c,skew:u}=e;n.rotation=a,n.scale=s,n.pivot.x=c.width*o.x,n.pivot.y=c.height*o.y,n.skew=u;let p=i.x,h=i.y;if(e.parent){const t=e.parent;p+=t.size.width*r.x,h+=t.size.height*r.y}n.position={x:p,y:h}}}var fe=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new o(r,i||t,a),c=n?n+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],s]:t._events[c].push(s):(t._events[c]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,a=new Array(i);o<i;o++)a[o]=r[o].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,o,i,a){var s=n?n+t:t;if(!this._events[s])return!1;var c,u,p=this._events[s],h=arguments.length;if(p.fn){switch(p.once&&this.removeListener(t,p.fn,void 0,!0),h){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,e),!0;case 3:return p.fn.call(p.context,e,r),!0;case 4:return p.fn.call(p.context,e,r,o),!0;case 5:return p.fn.call(p.context,e,r,o,i),!0;case 6:return p.fn.call(p.context,e,r,o,i,a),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];p.fn.apply(p.context,c)}else{var l,f=p.length;for(u=0;u<f;u++)switch(p[u].once&&this.removeListener(t,p[u].fn,void 0,!0),h){case 1:p[u].fn.call(p[u].context);break;case 2:p[u].fn.call(p[u].context,e);break;case 3:p[u].fn.call(p[u].context,e,r);break;case 4:p[u].fn.call(p[u].context,e,r,o);break;default:if(!c)for(l=1,c=new Array(h-1);l<h;l++)c[l-1]=arguments[l];p[u].fn.apply(p[u].context,c)}}return!0},s.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return a(this,i),this;var s=this._events[i];if(s.fn)s.fn!==e||o&&!s.once||r&&s.context!==r||a(this,i);else{for(var c=0,u=[],p=s.length;c<p;c++)(s[c].fn!==e||o&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[i]=1===u.length?u[0]:u:a(this,i)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}));let de=class extends fe{constructor({system:t,containerManager:e}){super(),this.name="Transform",this.waitRemoveIds=[],this.waitChangeScenes=[],this.containerManager=e,this.init(t)}init(t){this.system=t,this.on("changeScene",(({scene:t,mode:e,application:n})=>{this.waitChangeScenes.push({scene:t,mode:e,application:n})}))}update(){for(const t of this.waitRemoveIds)this.containerManager.removeContainer(t);this.waitRemoveIds=[];for(const t of this.waitChangeScenes){const e=this.containerManager.getContainer(t.scene.id);e&&(t.application.stage.removeChildren(),t.application.stage.addChild(e))}this.waitChangeScenes=[]}componentChanged(t){t.type===e.OBSERVER_TYPE.ADD?this.addContainer(t):t.type===e.OBSERVER_TYPE.CHANGE?this.change(t):t.type===e.OBSERVER_TYPE.REMOVE&&this.waitRemoveIds.push(t.gameObject.id)}addContainer(t){const e=new v;e.name=t.gameObject.name,this.containerManager.addContainer({name:t.gameObject.id,container:e});t.component.worldTransform=e.transform.worldTransform}change(t){const e=t.component;if(e.parent){this.containerManager.getContainer(e.parent.gameObject.id).addChild(this.containerManager.getContainer(t.gameObject.id));const n=t.gameObject.transform.parent&&t.gameObject.transform.parent.gameObject.getComponent("Render");n&&(n.sortDirty=!0)}else{const n=this.containerManager.getContainer(t.gameObject.id);delete e.worldTransform,n.parent&&n.parent.removeChild(n)}}destroy(){this.removeAllListeners(),this.waitRemoveIds=null,this.waitChangeScenes=null,this.system=null,this.containerManager=null}};de=r([e.decorators.componentObserver({Transform:["_parent"]})],de);var ve,ye=de;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(ve||(ve={}));const me=t=>{t.plugins.interaction.autoPreventDefault=!0,t.view.style.touchAction="none"},ge=t=>{t.plugins.interaction.autoPreventDefault=!1,t.view.style.touchAction="auto"};let be=class extends e.System{constructor(){super(...arguments),this.multiApps=[]}init(t){this.params=t,this.application=this.createApplication(t),this.containerManager=new le,this.rendererManager=new he({game:this.game,rendererSystem:this}),this.game.canvas=this.application.view,this.transform=new ye({system:this,containerManager:this.containerManager}),this.game.on("sceneChanged",(({scene:t,mode:n,params:r})=>{let o;switch(n){case e.LOAD_SCENE_MODE.SINGLE:o=this.application;break;case e.LOAD_SCENE_MODE.MULTI_CANVAS:o=this.createMultiApplication({params:r})}t.canvas=o.view,this.transform.emit("changeScene",{scene:t,mode:n,application:o})}))}registerObserver(t){const e=this.constructor.observerInfo;for(const n in t)e[n]||(e[n]=[]),e[n].push(...t[n])}createMultiApplication({params:t}){const e=this.createApplication(t);return this.multiApps.push(e),e}createApplication(t){t.view=t.canvas,t.renderType===ve.CANVAS&&(t.forceCanvas=!0),n.ticker.shared.autoStart=!1,n.ticker.shared.stop();const e=new d(Object.assign({sharedTicker:!0},t));return void 0!==t.preventScroll&&(console.warn("PreventScroll property will deprecate at next major version, please use enableEnable instead. https://eva.js.org/#/tutorials/game"),t.preventScroll?ge(e.renderer):me(e.renderer)),void 0!==t.enableScroll&&(t.enableScroll?ge(e.renderer):me(e.renderer)),void 0===t.preventScroll&&void 0===t.enableScroll&&ge(e.renderer),e}update(){const t=this.componentObserver.clear();for(const e of t)this.transform.componentChanged(e);for(const t of this.game.gameObjects)this.containerManager.updateTransform({name:t.id,transform:t.transform}),this.rendererManager.update(t)}lateUpdate(t){this.transform.update(),this.application.ticker.update(t.time)}onDestroy(){this.application.destroy();for(const t of this.multiApps)t&&t.destroy();this.transform.destroy(),this.transform=null,this.params=null,this.rendererManager=null,this.containerManager=null,this.application=null,this.game=null,this.multiApps=null}resize(t,e){this.params.width=t,this.params.height=e,this.application.renderer.resize(t,e)}};be.systemName="Renderer",be=r([e.decorators.componentObserver({Transform:["_parent"]})],be);var _e=be;const je=["hint","event","delay","attr","role","props","state","a11yId","name"],Oe=function(t,e,n){["touchstart","touchend","tap"].forEach((r=>{t.emit(r,{stopPropagation:()=>n.stopPropagation(),data:{position:this.eventPosition},gameObject:e})}))};let Ee=class extends e.System{constructor(t){super(t),this.cache=new Map,this.eventCache=new Map}get ratioX(){if(this._ratioX)return this._ratioX;return this.setRatio()?this._ratioX:0}get ratioY(){if(this._ratioY)return this._ratioY;return this.setRatio()?this._ratioY:0}init(e={}){return o(this,void 0,void 0,(function*(){const{activate:n=t.A11yActivate.CHECK,delay:r=100,checkA11yOpen:o=(()=>Promise.resolve(!1))}=e;switch(this.delay=r,n){case t.A11yActivate.CHECK:try{this.activate=yield o()}catch(t){this.activate=!1}break;case t.A11yActivate.DISABLE:this.activate=!1;break;case t.A11yActivate.ENABLE:this.activate=!0}if(this.debug=e.debug||!1,this.debug&&(this.activate=!0),!this.activate)return;const i=document.createElement("div");this.div=i,this.game.canvas.parentNode&&this.game.canvas.parentNode.appendChild(this.div)}))}setRatio(){const{width:t,height:e}=this.getCanvasBoundingClientRect(),{renderWidth:n,renderHeight:r}=this.getRenderRect();return this._ratioX=t/n,this._ratioY=e/r,!(!t&&!e)&&(this.initDiv(),!0)}getRenderRect(){const{params:t}=this.game.getSystem(_e)||{width:300,height:300},{height:e,width:n}=t;return{renderWidth:n,renderHeight:e}}getCanvasBoundingClientRect(){const{width:t,height:e,left:n,top:r}=this.game.canvas.getBoundingClientRect();return{width:t,height:e,left:n,top:r}}initDiv(){const{pageXOffset:t,pageYOffset:e}=window,{width:n,height:r,left:o,top:a}=this.getCanvasBoundingClientRect(),c={width:n,height:r,left:`${o+t}px`,top:`${a+e}px`,position:s,zIndex:3,pointerEvents:u.NONE,background:p.NONE};i(this.div,c),this.div.addEventListener("click",(t=>{const e=t.currentTarget,{left:n,top:r}=e.getBoundingClientRect(),o=(t.pageX-n)/this.ratioX,i=(t.pageY-r)/this.ratioY;this.eventPosition={x:o,y:i}}),!0)}update(){return o(this,void 0,void 0,(function*(){const t=this.componentObserver.clear();if(this.activate)for(const n of t)switch(n.type){case e.OBSERVER_TYPE.ADD:"Event"===n.componentName&&this.addEvent(n.gameObject),"A11y"===n.componentName&&this.add(n);break;case e.OBSERVER_TYPE.CHANGE:"Transform"===n.componentName&&this.transformChange(n);break;case e.OBSERVER_TYPE.REMOVE:"Event"===n.componentName&&this.removeEvent(n),"A11y"===n.componentName&&this.remove(n)}}))}remove(t){const e=t.component;if(!e)return;const{a11yId:n}=e,r=this.div.querySelector(`#${n}`);r&&this.div.removeChild(r),this.cache.delete(n)}add(t){if(!this.activate)return;const e=t.component,{gameObject:n}=t,{delay:r,a11yId:o}=e;let{event:i}=e;if(!n)return;const{transform:a}=n;if(!a)return;const s=document.createElement("div");this.cache.set(o,s),i||(i=n.getComponent("Event")),setTimeout((()=>{this.setPosition(s,a),this.setA11yAttr(s,e),i&&this.addEvent(n),n.scene&&this.div.appendChild(s)}),r||this.delay)}transformChange(t){const e=t.component,{gameObject:n}=t,r=n.getComponent(a);if(!r)return;const{a11yId:o}=r;if(e.inScene){if(this.cache.has(o)){const t=this.cache.get(o);t&&this.div.appendChild(t)}}else{const t=this.div.querySelector(`#${o}`);t&&this.div.removeChild(t)}}setEvent(t,e,n,r){if(!e)return;const o=Oe.bind(this,e,n);this.eventCache.set(r,o),t.addEventListener("click",o)}addEvent(t){const e=t.getComponent(a);if(!e)return;const n=t.getComponent("Event");if(!n)return;const r=this.cache.get(e.a11yId);r&&this.setEvent(r,n,t,e.a11yId)}removeEvent(t){const{gameObject:e}=t,n=e.getComponent(a);if(!n)return;if(!t.component)return;const{a11yId:r}=n,o=this.eventCache.get(r),i=this.cache.get(r);i&&i.removeEventListener("click",o)}setA11yAttr(t,e){const{hint:n,props:r={},state:o={},role:i,a11yId:a}=e,s=i||"text";t.setAttribute("role",s),t.setAttribute("aria-label",n),t.id=a;const c=Object.keys(r);for(const e of c)t.setAttribute(e,r[e]);const u=Object.keys(o);for(const e of u)t.setAttribute(e,o[e]);for(let n of Object.keys(e))"string"==typeof e[n]&&-1===je.indexOf(n)&&1!==n.indexOf("_")&&t.setAttribute(n,e[n])}setPosition(t,e){const{width:n,height:r}=e.size,o={width:0===n?1:n*this.ratioX,height:0===r?1:r*this.ratioY,position:s,zIndex:3,pointerEvents:u.AUTO,background:this.debug?p.DEBUG:p.NONE},a=Object.assign({},e);i(t,o),((t,e,n,r)=>{const{worldTransform:o}=e,{a:i,b:a,c:s,d:c,tx:u,ty:p}=o,h=`matrix(${i}, ${a}, ${s}, ${c}, ${u*n}, ${p*r})`;t.style.transform=`${h}`,t.style.webkitTransform=`${h}`,t.style.transformOrigin="left top",t.style.webkitTransformOrigin="left top"})(t,a,this.ratioX,this.ratioY)}onDestroy(){this.div.parentElement.removeChild(this.div),this.cache=null,this.eventCache=null}};Ee.systemName="A11ySystem",Ee=r([e.decorators.componentObserver({A11y:[],Transform:["inScene"],Event:[]})],Ee);var we=Ee;t.A11y=a,t.A11ySystem=we,Object.defineProperty(t,"__esModule",{value:!0})}));
