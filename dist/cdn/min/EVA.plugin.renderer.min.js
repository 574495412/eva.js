!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/renderer-adapter"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/renderer-adapter","pixi.js"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer={}),e.EVA,e.EVA.rendererAdapter,e.PIXI)}(this,(function(e,t,r,n){"use strict";function o(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}function i(e,t){return e===t||e!=e&&t!=t}function s(e,t){for(var r=e.length;r--;)if(i(e[r][0],t))return r;return-1}var a=Array.prototype.splice;function _(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}_.prototype.clear=function(){this.__data__=[],this.size=0},_.prototype.delete=function(e){var t=this.__data__,r=s(t,e);return!(r<0)&&(r==t.length-1?t.pop():a.call(t,r,1),--this.size,!0)},_.prototype.get=function(e){var t=this.__data__,r=s(t,e);return r<0?void 0:t[r][1]},_.prototype.has=function(e){return s(this.__data__,e)>-1},_.prototype.set=function(e,t){var r=this.__data__,n=s(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var c="object"==typeof global&&global&&global.Object===Object&&global,u="object"==typeof self&&self&&self.Object===Object&&self,h=c||u||Function("return this")(),l=h.Symbol,p=Object.prototype,E=p.hasOwnProperty,f=p.toString,d=l?l.toStringTag:void 0;var R=Object.prototype.toString;var S=l?l.toStringTag:void 0;function A(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":S&&S in Object(e)?function(e){var t=E.call(e,d),r=e[d];try{e[d]=void 0;var n=!0}catch(e){}var o=f.call(e);return n&&(t?e[d]=r:delete e[d]),o}(e):function(e){return R.call(e)}(e)}function T(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function O(e){if(!T(e))return!1;var t=A(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var m,C=h["__core-js_shared__"],g=(m=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"";var y=Function.prototype.toString;function P(e){if(null!=e){try{return y.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var v=/^\[object .+?Constructor\]$/,b=Function.prototype,L=Object.prototype,M=b.toString,D=L.hasOwnProperty,N=RegExp("^"+M.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function B(e){return!(!T(e)||(t=e,g&&g in t))&&(O(e)?N:v).test(P(e));var t}function x(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return B(r)?r:void 0}var G=x(h,"Map"),I=x(Object,"create");var w=Object.prototype.hasOwnProperty;var H=Object.prototype.hasOwnProperty;function U(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function j(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function X(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}U.prototype.clear=function(){this.__data__=I?I(null):{},this.size=0},U.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},U.prototype.get=function(e){var t=this.__data__;if(I){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return w.call(t,e)?t[e]:void 0},U.prototype.has=function(e){var t=this.__data__;return I?void 0!==t[e]:H.call(t,e)},U.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=I&&void 0===t?"__lodash_hash_undefined__":t,this},X.prototype.clear=function(){this.size=0,this.__data__={hash:new U,map:new(G||_),string:new U}},X.prototype.delete=function(e){var t=j(this,e).delete(e);return this.size-=t?1:0,t},X.prototype.get=function(e){return j(this,e).get(e)},X.prototype.has=function(e){return j(this,e).has(e)},X.prototype.set=function(e,t){var r=j(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function F(e){var t=this.__data__=new _(e);this.size=t.size}F.prototype.clear=function(){this.__data__=new _,this.size=0},F.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},F.prototype.get=function(e){return this.__data__.get(e)},F.prototype.has=function(e){return this.__data__.has(e)},F.prototype.set=function(e,t){var r=this.__data__;if(r instanceof _){var n=r.__data__;if(!G||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new X(n)}return r.set(e,t),this.size=r.size,this};function K(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new X;++t<r;)this.add(e[t])}function k(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}K.prototype.add=K.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},K.prototype.has=function(e){return this.__data__.has(e)};function V(e,t,r,n,o,i){var s=1&r,a=e.length,_=t.length;if(a!=_&&!(s&&_>a))return!1;var c=i.get(e),u=i.get(t);if(c&&u)return c==t&&u==e;var h=-1,l=!0,p=2&r?new K:void 0;for(i.set(e,t),i.set(t,e);++h<a;){var E=e[h],f=t[h];if(n)var d=s?n(f,E,h,t,e,i):n(E,f,h,e,t,i);if(void 0!==d){if(d)continue;l=!1;break}if(p){if(!k(t,(function(e,t){if(s=t,!p.has(s)&&(E===e||o(E,e,r,n,i)))return p.push(t);var s}))){l=!1;break}}else if(E!==f&&!o(E,f,r,n,i)){l=!1;break}}return i.delete(e),i.delete(t),l}var W=h.Uint8Array;function q(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function Y(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var z=l?l.prototype:void 0,$=z?z.valueOf:void 0;var J=Array.isArray;var Q=Object.prototype.propertyIsEnumerable,Z=Object.getOwnPropertySymbols,ee=Z?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,i=[];++r<n;){var s=e[r];t(s,r,e)&&(i[o++]=s)}return i}(Z(e),(function(t){return Q.call(e,t)})))}:function(){return[]};function te(e){return null!=e&&"object"==typeof e}function re(e){return te(e)&&"[object Arguments]"==A(e)}var ne=Object.prototype,oe=ne.hasOwnProperty,ie=ne.propertyIsEnumerable,se=re(function(){return arguments}())?re:function(e){return te(e)&&oe.call(e,"callee")&&!ie.call(e,"callee")};var ae="object"==typeof e&&e&&!e.nodeType&&e,_e=ae&&"object"==typeof module&&module&&!module.nodeType&&module,ce=_e&&_e.exports===ae?h.Buffer:void 0,ue=(ce?ce.isBuffer:void 0)||function(){return!1},he=/^(?:0|[1-9]\d*)$/;function le(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&he.test(e))&&e>-1&&e%1==0&&e<t}function pe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var Ee={};Ee["[object Float32Array]"]=Ee["[object Float64Array]"]=Ee["[object Int8Array]"]=Ee["[object Int16Array]"]=Ee["[object Int32Array]"]=Ee["[object Uint8Array]"]=Ee["[object Uint8ClampedArray]"]=Ee["[object Uint16Array]"]=Ee["[object Uint32Array]"]=!0,Ee["[object Arguments]"]=Ee["[object Array]"]=Ee["[object ArrayBuffer]"]=Ee["[object Boolean]"]=Ee["[object DataView]"]=Ee["[object Date]"]=Ee["[object Error]"]=Ee["[object Function]"]=Ee["[object Map]"]=Ee["[object Number]"]=Ee["[object Object]"]=Ee["[object RegExp]"]=Ee["[object Set]"]=Ee["[object String]"]=Ee["[object WeakMap]"]=!1;var fe,de="object"==typeof e&&e&&!e.nodeType&&e,Re=de&&"object"==typeof module&&module&&!module.nodeType&&module,Se=Re&&Re.exports===de&&c.process,Ae=function(){try{var e=Re&&Re.require&&Re.require("util").types;return e||Se&&Se.binding&&Se.binding("util")}catch(e){}}(),Te=Ae&&Ae.isTypedArray,Oe=Te?(fe=Te,function(e){return fe(e)}):function(e){return te(e)&&pe(e.length)&&!!Ee[A(e)]},me=Object.prototype.hasOwnProperty;function Ce(e,t){var r=J(e),n=!r&&se(e),o=!r&&!n&&ue(e),i=!r&&!n&&!o&&Oe(e),s=r||n||o||i,a=s?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],_=a.length;for(var c in e)!t&&!me.call(e,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||le(c,_))||a.push(c);return a}var ge=Object.prototype;var ye=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Pe=Object.prototype.hasOwnProperty;function ve(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||ge))return ye(e);var t,r,n=[];for(var o in Object(e))Pe.call(e,o)&&"constructor"!=o&&n.push(o);return n}function be(e){return null!=(t=e)&&pe(t.length)&&!O(t)?Ce(e):ve(e);var t}function Le(e){return function(e,t,r){var n=t(e);return J(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,be,ee)}var Me=Object.prototype.hasOwnProperty;var De=x(h,"DataView"),Ne=x(h,"Promise"),Be=x(h,"Set"),xe=x(h,"WeakMap"),Ge="[object Map]",Ie="[object Promise]",we="[object Set]",He="[object WeakMap]",Ue="[object DataView]",je=P(De),Xe=P(G),Fe=P(Ne),Ke=P(Be),ke=P(xe),Ve=A;(De&&Ve(new De(new ArrayBuffer(1)))!=Ue||G&&Ve(new G)!=Ge||Ne&&Ve(Ne.resolve())!=Ie||Be&&Ve(new Be)!=we||xe&&Ve(new xe)!=He)&&(Ve=function(e){var t=A(e),r="[object Object]"==t?e.constructor:void 0,n=r?P(r):"";if(n)switch(n){case je:return Ue;case Xe:return Ge;case Fe:return Ie;case Ke:return we;case ke:return He}return t});var We=Ve,qe="[object Arguments]",Ye="[object Array]",ze="[object Object]",$e=Object.prototype.hasOwnProperty;function Je(e,t,r,n,o,s){var a=J(e),_=J(t),c=a?Ye:We(e),u=_?Ye:We(t),h=(c=c==qe?ze:c)==ze,l=(u=u==qe?ze:u)==ze,p=c==u;if(p&&ue(e)){if(!ue(t))return!1;a=!0,h=!1}if(p&&!h)return s||(s=new F),a||Oe(e)?V(e,t,r,n,o,s):function(e,t,r,n,o,s,a){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new W(e),new W(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var _=q;case"[object Set]":var c=1&n;if(_||(_=Y),e.size!=t.size&&!c)return!1;var u=a.get(e);if(u)return u==t;n|=2,a.set(e,t);var h=V(_(e),_(t),n,o,s,a);return a.delete(e),h;case"[object Symbol]":if($)return $.call(e)==$.call(t)}return!1}(e,t,c,r,n,o,s);if(!(1&r)){var E=h&&$e.call(e,"__wrapped__"),f=l&&$e.call(t,"__wrapped__");if(E||f){var d=E?e.value():e,R=f?t.value():t;return s||(s=new F),o(d,R,r,n,s)}}return!!p&&(s||(s=new F),function(e,t,r,n,o,i){var s=1&r,a=Le(e),_=a.length;if(_!=Le(t).length&&!s)return!1;for(var c=_;c--;){var u=a[c];if(!(s?u in t:Me.call(t,u)))return!1}var h=i.get(e),l=i.get(t);if(h&&l)return h==t&&l==e;var p=!0;i.set(e,t),i.set(t,e);for(var E=s;++c<_;){var f=e[u=a[c]],d=t[u];if(n)var R=s?n(d,f,u,t,e,i):n(f,d,u,e,t,i);if(!(void 0===R?f===d||o(f,d,r,n,i):R)){p=!1;break}E||(E="constructor"==u)}if(p&&!E){var S=e.constructor,A=t.constructor;S==A||!("constructor"in e)||!("constructor"in t)||"function"==typeof S&&S instanceof S&&"function"==typeof A&&A instanceof A||(p=!1)}return i.delete(e),i.delete(t),p}(e,t,r,n,o,s))}function Qe(e,t,r,n,o){return e===t||(null==e||null==t||!te(e)&&!te(t)?e!=e&&t!=t:Je(e,t,r,n,Qe,o))}class Ze{constructor({game:e,rendererSystem:t}){this.renderers=[],this.game=e,this.rendererSystem=t}register(...e){for(const t of e)t.game=this.game,t.rendererManager=this.rendererSystem.rendererManager,t.containerManager=this.rendererSystem.containerManager,this.renderers.push(t)}componentChanged(e){for(const r of e)for(const e of this.renderers){const n=e.observerInfo[r.componentName];if(n){if([t.OBSERVER_TYPE.ADD,t.OBSERVER_TYPE.REMOVE].indexOf(r.type)>-1){try{e.componentChanged&&e.componentChanged(r)}catch(e){console.error(`gameObject: ${r.gameObject.name}, ${r.componentName} is error.`,r,e)}continue}if(n.findIndex((e=>{return t=e,n=r.prop,Qe(t,n);var t,n}))>-1)try{e.componentChanged&&e.componentChanged(r)}catch(e){console.error(`gameObject: ${r.gameObject&&r.gameObject.name}, ${r.componentName} is componentChanged error.`,r,e)}}}}update(e){for(const t of e.components)for(const r of this.renderers){const n=[];if(r.observerInfo[t.name]&&-1===n.indexOf(e)){n.push(e);try{r.rendererUpdate&&r.rendererUpdate(e)}catch(r){console.info(`gameObject: ${e.name}, ${t.name} is update error`,r)}}}}}class et{constructor(){this.containerMap={}}addContainer({name:e,container:t}){this.containerMap[e]=t}getContainer(e){return this.containerMap[e]}removeContainer(e){var t;null===(t=this.containerMap[e])||void 0===t||t.destroy(!0),delete this.containerMap[e]}updateTransform({name:e,transform:t}){const r=this.containerMap[e];if(!r)return;const{anchor:n,origin:o,position:i,rotation:s,scale:a,size:_,skew:c}=t;r.rotation=s,r.scale=a,r.pivot.x=_.width*o.x,r.pivot.y=_.height*o.y,r.skew=c;let u=i.x,h=i.y;if(t.parent){const e=t.parent;u+=e.size.width*n.x,h+=e.size.height*n.y}r.position={x:u,y:h}}}var tt=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||e,s),_=r?r+t:t;return e._events[_]?e._events[_].fn?e._events[_]=[e._events[_],a]:e._events[_].push(a):(e._events[_]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,o,i,s){var a=r?r+e:e;if(!this._events[a])return!1;var _,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,o),!0;case 5:return u.fn.call(u.context,t,n,o,i),!0;case 6:return u.fn.call(u.context,t,n,o,i,s),!0}for(c=1,_=new Array(h-1);c<h;c++)_[c-1]=arguments[c];u.fn.apply(u.context,_)}else{var l,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,o);break;default:if(!_)for(l=1,_=new Array(h-1);l<h;l++)_[l-1]=arguments[l];u[c].fn.apply(u[c].context,_)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||o&&!a.once||n&&a.context!==n||s(this,i);else{for(var _=0,c=[],u=a.length;_<u;_++)(a[_].fn!==t||o&&!a[_].once||n&&a[_].context!==n)&&c.push(a[_]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}));let rt=class extends tt{constructor({system:e,containerManager:t}){super(),this.name="Transform",this.waitRemoveIds=[],this.waitChangeScenes=[],this.containerManager=t,this.init(e)}init(e){this.system=e,this.on("changeScene",(({scene:e,mode:t,application:r})=>{this.waitChangeScenes.push({scene:e,mode:t,application:r})}))}update(){for(const e of this.waitRemoveIds)this.containerManager.removeContainer(e);this.waitRemoveIds=[];for(const e of this.waitChangeScenes){const t=this.containerManager.getContainer(e.scene.id);t&&(e.application.stage.removeChildren(),e.application.stage.addChild(t))}this.waitChangeScenes=[]}componentChanged(e){e.type===t.OBSERVER_TYPE.ADD?this.addContainer(e):e.type===t.OBSERVER_TYPE.CHANGE?this.change(e):e.type===t.OBSERVER_TYPE.REMOVE&&this.waitRemoveIds.push(e.gameObject.id)}addContainer(e){const t=new r.Container;t.name=e.gameObject.name,this.containerManager.addContainer({name:e.gameObject.id,container:t});e.component.worldTransform=t.transform.worldTransform}change(e){const t=e.component;if(t.parent){this.containerManager.getContainer(t.parent.gameObject.id).addChild(this.containerManager.getContainer(e.gameObject.id));const r=e.gameObject.transform.parent&&e.gameObject.transform.parent.gameObject.getComponent("Render");r&&(r.sortDirty=!0)}else{const r=this.containerManager.getContainer(e.gameObject.id);delete t.worldTransform,r.parent&&r.parent.removeChild(r)}}destroy(){this.removeAllListeners(),this.waitRemoveIds=null,this.waitChangeScenes=null,this.system=null,this.containerManager=null}};rt=o([t.decorators.componentObserver({Transform:["_parent"]})],rt);var nt=rt;let ot;var it=function(){function e(e,t,r){void 0===t&&(t=!1),this.next=null,this.prev=null,this.owner=null,this.fn=e,this.once=t,this.thisArg=r}return e.prototype.detach=function(){return null!==this.owner&&(this.owner.detach(this),!0)},e.prototype.dispose=function(){this.detach()},e}(),st=function(){function e(){this._head=null,this._tail=null,this._filter=null}return e.prototype.handlers=function(){for(var e=this._head,t=[];e;)t.push(e),e=e.next;return t},e.prototype.hasAny=function(){return!!this._head},e.prototype.has=function(e){return e.owner===this},e.prototype.dispatch=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._head;if(!r)return!1;if(this._filter&&!this._filter.apply(this,e))return!1;for(;r;)r.once&&this.detach(r),r.fn.apply(r.thisArg,e),r=r.next;return!0},e.prototype.add=function(e,t){return void 0===t&&(t=null),this._addSignalBinding(new it(e,!1,t))},e.prototype.once=function(e,t){return void 0===t&&(t=null),this._addSignalBinding(new it(e,!0,t))},e.prototype.detach=function(e){var t=e;return t.owner!==this||(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this._head?(this._head=t.next,null===t.next&&(this._tail=null)):t===this._tail&&(this._tail=t.prev,this._tail&&(this._tail.next=null)),t.owner=null),this},e.prototype.detachAll=function(){var e=this._head;if(!e)return this;for(this._head=null,this._tail=null;e;)e.owner=null,e=e.next;return this},e.prototype.filter=function(e){this._filter=e},e.prototype.proxy=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.dispatch.apply(e,t)},o=0;o<t.length;++o)t[o].add(n);return this},e.prototype._addSignalBinding=function(e){var t=e;return this._head?(this._tail&&(this._tail.next=t),t.prev=this._tail,this._tail=t):(this._head=t,this._tail=t),t.owner=this,t},e}();var at,_t,ct=function(e,t){if(e){t=t||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[t.strictMode?"strict":"loose"].exec(e),o={},i=14;i--;)o[r.key[i]]=n[i]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,(function(e,t,n){t&&(o[r.q.name][t]=n)})),o}},ut=function(e){this.config=e,this.onError=new st,this.onComplete=new st,this.onProgress=new st},ht=function(e,t){return(ht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function lt(e,t){function r(){this.constructor=e}ht(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function pt(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function Et(e){var t="";if(0===e.indexOf("data:")){var r=e.indexOf("/");t=e.substring(r+1,e.indexOf(";",r))}else{var n=e.indexOf("?"),o=e.indexOf("#"),i=Math.min(n>-1?n:e.length,o>-1?o:e.length);t=(e=e.substring(0,i)).substring(e.lastIndexOf(".")+1)}return t.toLowerCase()}function ft(e){throw new Error("Unexpected value. Should have been never.")}!function(e){e[e.Unknown=0]="Unknown",e[e.Buffer=1]="Buffer",e[e.Blob=2]="Blob",e[e.Json=3]="Json",e[e.Xml=4]="Xml",e[e.Image=5]="Image",e[e.Audio=6]="Audio",e[e.Video=7]="Video",e[e.Text=8]="Text"}(at||(at={})),function(e){e[e.NotStarted=0]="NotStarted",e[e.Loading=1]="Loading",e[e.Complete=2]="Complete"}(_t||(_t={}));var dt,Rt=function(e){function t(t,r){var n=e.call(this,t)||this;return n.elementType=r,n._boundOnLoad=n._onLoad.bind(n),n._boundOnError=n._onError.bind(n),n._boundOnTimeout=n._onTimeout.bind(n),n._element=n._createElement(),n._elementTimer=0,n}return lt(t,e),t.prototype.load=function(){var e=this.config;e.crossOrigin&&(this._element.crossOrigin=e.crossOrigin);var t=e.sourceSet||[e.url];if(navigator.isCocoonJS)this._element.src=t[0];else for(var r=0;r<t.length;++r){var n=t[r],o=e.mimeTypes?e.mimeTypes[r]:void 0;o||(o=this.elementType+"/"+Et(n));var i=document.createElement("source");i.src=n,i.type=o,this._element.appendChild(i)}this._element.addEventListener("load",this._boundOnLoad,!1),this._element.addEventListener("canplaythrough",this._boundOnLoad,!1),this._element.addEventListener("error",this._boundOnError,!1),this._element.load(),e.timeout&&(this._elementTimer=window.setTimeout(this._boundOnTimeout,e.timeout))},t.prototype.abort=function(){for(this._clearEvents();this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._error(this.elementType+" load aborted by the user.")},t.prototype._createElement=function(){return this.config.loadElement?this.config.loadElement:document.createElement(this.elementType)},t.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this._element.removeEventListener("load",this._boundOnLoad,!1),this._element.removeEventListener("canplaythrough",this._boundOnLoad,!1),this._element.removeEventListener("error",this._boundOnError,!1)},t.prototype._error=function(e){this._clearEvents(),this.onError.dispatch(e)},t.prototype._complete=function(){this._clearEvents();var e=at.Unknown;switch(this.elementType){case"audio":e=at.Audio;break;case"video":e=at.Video;break;default:ft(this.elementType)}this.onComplete.dispatch(e,this._element)},t.prototype._onLoad=function(){this._complete()},t.prototype._onError=function(){this._error(this.elementType+" failed to load.")},t.prototype._onTimeout=function(){this._error(this.elementType+" load timed out.")},t}(ut),St=function(e){function t(t){return e.call(this,t,"audio")||this}return lt(t,e),t}(Rt),At=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._boundOnLoad=t._onLoad.bind(t),t._boundOnError=t._onError.bind(t),t._boundOnTimeout=t._onTimeout.bind(t),t._element=t._createElement(),t._elementTimer=0,t}return lt(t,e),t.prototype.load=function(){var e=this.config;e.crossOrigin&&(this._element.crossOrigin=e.crossOrigin),this._element.src=e.url,this._element.addEventListener("load",this._boundOnLoad,!1),this._element.addEventListener("error",this._boundOnError,!1),e.timeout&&(this._elementTimer=window.setTimeout(this._boundOnTimeout,e.timeout))},t.prototype.abort=function(){this._clearEvents(),this._element.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",this._error("Image load aborted by the user.")},t.prototype._createElement=function(){return this.config.loadElement?this.config.loadElement:document.createElement("img")},t.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this._element.removeEventListener("load",this._boundOnLoad,!1),this._element.removeEventListener("error",this._boundOnError,!1)},t.prototype._error=function(e){this._clearEvents(),this.onError.dispatch(e)},t.prototype._complete=function(){this._clearEvents(),this.onComplete.dispatch(at.Image,this._element)},t.prototype._onLoad=function(){this._complete()},t.prototype._onError=function(){this._error("Image failed to load.")},t.prototype._onTimeout=function(){this._error("Image load timed out.")},t}(ut),Tt=function(e){function t(t){return e.call(this,t,"video")||this}return lt(t,e),t}(Rt),Ot=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest);function mt(e){return e.toString().replace("object ","")}!function(e){e.Default="text",e.Buffer="arraybuffer",e.Blob="blob",e.Document="document",e.Json="json",e.Text="text"}(dt||(dt={}));var Ct=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._boundOnLoad=t._onLoad.bind(t),t._boundOnAbort=t._onAbort.bind(t),t._boundOnError=t._onError.bind(t),t._boundOnTimeout=t._onTimeout.bind(t),t._boundOnProgress=t._onProgress.bind(t),t._xhr=t._createRequest(),t._xhrType=dt.Default,t}return lt(t,e),t.prototype.load=function(){var e=this.config,t=Et(e.url);"string"!=typeof e.xhrType&&(e.xhrType=this._determineXhrType(t));var r=this._xhr;this._xhrType=e.xhrType||dt.Default,Ot?(r.timeout=e.timeout||5e3,r.onload=this._boundOnLoad,r.onerror=this._boundOnError,r.ontimeout=this._boundOnTimeout,r.onprogress=this._boundOnProgress,r.open("GET",e.url,!0),setTimeout((function(){r.send()}),0)):(r.open("GET",e.url,!0),e.timeout&&(r.timeout=e.timeout),e.xhrType===dt.Json||e.xhrType===dt.Document?r.responseType=dt.Text:r.responseType=e.xhrType,r.addEventListener("load",this._boundOnLoad,!1),r.addEventListener("abort",this._boundOnAbort,!1),r.addEventListener("error",this._boundOnError,!1),r.addEventListener("timeout",this._boundOnTimeout,!1),r.addEventListener("progress",this._boundOnProgress,!1),r.send())},t.prototype.abort=function(){Ot?(this._clearEvents(),this._xhr.abort(),this._onAbort()):this._xhr.abort()},t.prototype._createRequest=function(){return Ot?new window.XDomainRequest:new XMLHttpRequest},t.prototype._determineXhrType=function(e){return t._xhrTypeMap[e]||dt.Default},t.prototype._clearEvents=function(){Ot?(this._xhr.onload=null,this._xhr.onerror=null,this._xhr.ontimeout=null,this._xhr.onprogress=null):(this._xhr.removeEventListener("load",this._boundOnLoad,!1),this._xhr.removeEventListener("abort",this._boundOnAbort,!1),this._xhr.removeEventListener("error",this._boundOnError,!1),this._xhr.removeEventListener("timeout",this._boundOnTimeout,!1),this._xhr.removeEventListener("progress",this._boundOnProgress,!1))},t.prototype._error=function(e){this._clearEvents(),this.onError.dispatch(e)},t.prototype._complete=function(e,t){this._clearEvents(),this.onComplete.dispatch(e,t)},t.prototype._onLoad=function(){var e=this._xhr,t="",r=void 0===e.status?200:e.status;if(void 0!==e.responseType&&""!==e.responseType&&"text"!==e.responseType||(t=e.responseText),0===r&&(t.length>0||e.responseType===dt.Buffer)?r=200:1223===r&&(r=204),200===100*Math.floor(r/100))switch(this._xhrType){case dt.Buffer:this._complete(at.Buffer,e.response);break;case dt.Blob:this._complete(at.Blob,e.response);break;case dt.Document:this._parseDocument(t);break;case dt.Json:this._parseJson(t);break;case dt.Default:case dt.Text:this._complete(at.Text,t);break;default:ft(this._xhrType)}else this._error("["+e.status+"] "+e.statusText+": "+e.responseURL)},t.prototype._parseDocument=function(e){try{if(window.DOMParser){var t=(new DOMParser).parseFromString(e,"text/xml");this._complete(at.Xml,t)}else{var r=document.createElement("div");r.innerHTML=e,this._complete(at.Xml,r)}}catch(e){this._error("Error trying to parse loaded xml: "+e)}},t.prototype._parseJson=function(e){try{var t=JSON.parse(e);this._complete(at.Json,t)}catch(e){this._error("Error trying to parse loaded json: "+e)}},t.prototype._onAbort=function(){var e=this._xhr;this._error(mt(e)+" Request was aborted by the user.")},t.prototype._onError=function(){var e=this._xhr;this._error(mt(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},t.prototype._onTimeout=function(){var e=this._xhr;this._error(mt(e)+" Request timed out.")},t.prototype._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(e.loaded/e.total)},t.setExtensionXhrType=function(e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t._xhrTypeMap[e]=r)},t.ResponseType=dt,t._xhrTypeMap={xhtml:dt.Document,html:dt.Document,htm:dt.Document,xml:dt.Document,tmx:dt.Document,svg:dt.Document,tsx:dt.Document,gif:dt.Blob,png:dt.Blob,bmp:dt.Blob,jpg:dt.Blob,jpeg:dt.Blob,tif:dt.Blob,tiff:dt.Blob,webp:dt.Blob,tga:dt.Blob,json:dt.Json,text:dt.Text,txt:dt.Text,ttf:dt.Buffer,otf:dt.Buffer},t}(ut);function gt(e){var t=e;return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(null===t)throw new Error("Callback was already called.");var n=t;return t=null,n.apply(this,e)}}var yt=function(){function e(e,t){if(void 0===t&&(t=1),this.worker=e,this.concurrency=t,this.workers=0,this.buffer=0,this.paused=!1,this._started=!1,this._tasks=[],this.onSaturated=new st,this.onUnsaturated=new st,this.onEmpty=new st,this.onDrain=new st,this.onError=new st,0===t)throw new Error("Concurrency must not be zero");this.buffer=t/4}return Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.onDrain.detachAll(),this.workers=0,this._started=!1,this._tasks=[]},e.prototype.push=function(e,t){this._insert(e,!1,t)},e.prototype.unshift=function(e,t){this._insert(e,!0,t)},e.prototype.process=function(){for(;!this.paused&&this.workers<this.concurrency&&this._tasks.length;){var e=this._tasks.shift();0===this._tasks.length&&this.onEmpty.dispatch(),this.workers+=1,this.workers===this.concurrency&&this.onSaturated.dispatch(),this.worker(e.data,gt(this._next(e)))}},e.prototype.length=function(){return this._tasks.length},e.prototype.running=function(){return this.workers},e.prototype.idle=function(){return this._tasks.length+this.workers===0},e.prototype.pause=function(){!0!==this.paused&&(this.paused=!0)},e.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var e=1;e<=this.concurrency;e++)this.process()}},e.prototype.getTask=function(e){return this._tasks[e]},e.prototype._insert=function(e,t,r){var n=this;if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(this._started=!0,null==e&&this.idle())setTimeout((function(){return n.onDrain.dispatch()}),1);else{var o={data:e,callback:r};t?this._tasks.unshift(o):this._tasks.push(o),setTimeout((function(){return n.process()}),1)}},e.prototype._next=function(e){var t=this;return function(r){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];t.workers-=1,e.callback&&e.callback.apply(e,pt([r],n)),r&&t.onError.dispatch(r,e.data),t.workers<=t.concurrency-t.buffer&&t.onUnsaturated.dispatch(),t.idle()&&t.onDrain.dispatch(),t.process()}},e}(),Pt=function(){function e(t,r){if(this.children=[],this.onStart=new st,this.onProgress=new st,this.onComplete=new st,this.onAfterMiddleware=new st,this.data=null,this.type=at.Unknown,this.error="",this.progressChunk=0,this._dequeue=function(){},this._onCompleteBinding=null,this._state=_t.NotStarted,this.name=t,this.metadata=r.metadata,"string"!=typeof r.crossOrigin&&(r.crossOrigin=this._determineCrossOrigin(r.url)),r.strategy&&"function"!=typeof r.strategy)this._strategy=r.strategy,this._strategy.config=r;else{var n=r.strategy;n||(n=e._loadStrategyMap[Et(r.url)]),n||(n=e._defaultLoadStrategy),this._strategy=new n(r)}this._strategy.onError.add(this._error,this),this._strategy.onComplete.add(this._complete,this),this._strategy.onProgress.add(this._progress,this)}return e.setDefaultLoadStrategy=function(t){e._defaultLoadStrategy=t},e.setLoadStrategy=function(t,r){t&&0===t.indexOf(".")&&(t=t.substring(1)),t&&(e._loadStrategyMap[t]=r)},Object.defineProperty(e.prototype,"strategy",{get:function(){return this._strategy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._strategy.config.url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._state===_t.Loading},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._state===_t.Complete},enumerable:!0,configurable:!0}),e.prototype.abort=function(){this._strategy.abort()},e.prototype.load=function(){this._state=_t.Loading,this.onStart.dispatch(this),this._strategy.load()},e.prototype._error=function(e){this._state=_t.Complete,this.error=e,this.onComplete.dispatch(this)},e.prototype._complete=function(e,t){this._state=_t.Complete,this.type=e,this.data=t,this.onComplete.dispatch(this)},e.prototype._progress=function(e){this.onProgress.dispatch(this,e)},e.prototype._determineCrossOrigin=function(t,r){if(void 0===r&&(r=window.location),0===t.indexOf("data:")||0===t.indexOf("javascript:"))return"";if(window.origin!==window.location.origin)return"anonymous";e._tempAnchor||(e._tempAnchor=document.createElement("a")),e._tempAnchor.href=t;var n=ct(e._tempAnchor.href,{strictMode:!0}),o=!n.port&&""===r.port||n.port===r.port,i=n.protocol?n.protocol+":":"";return n.host===r.hostname&&o&&i===r.protocol?"":"anonymous"},e._tempAnchor=null,e._defaultLoadStrategy=Ct,e._loadStrategyMap={gif:At,png:At,bmp:At,jpg:At,jpeg:At,tif:At,tiff:At,webp:At,tga:At,svg:At,"svg+xml":At,mp3:St,ogg:St,wav:St,mp4:Tt,webm:Tt,mov:Tt},e}();var vt,bt,Lt,Mt,Dt,Nt,Bt,xt,Gt,It,wt,Ht,Ut,jt,Xt,Ft,Kt,kt,Vt,Wt=/(#[\w-]+)?$/;!function(){function e(t,r){void 0===t&&(t=""),void 0===r&&(r=10),this.progress=0,this.loading=!1,this.defaultQueryString="",this.resources={},this.onError=new st,this.onLoad=new st,this.onStart=new st,this.onComplete=new st,this.onProgress=new st,this._baseUrl="",this._urlResolvers=[],this._middleware=[],this._resourcesParsing=[],this._boundLoadResource=this._loadResource.bind(this),this.baseUrl=t,this._queue=new yt(this._boundLoadResource,r),this._queue.pause(),this._middleware=e._defaultMiddleware.slice()}Object.defineProperty(e.prototype,"baseUrl",{get:function(){return this._baseUrl},set:function(e){for(;e.length&&"/"===e.charAt(e.length-1);)e=e.slice(0,-1);this._baseUrl=e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){if(Array.isArray(e)){for(var r=0;r<e.length;++r)this.add(e[r]);return this}var n="",o="",i=this._baseUrl,s={url:""};if("object"==typeof e?(n=e.url,o=e.name||e.url,i=e.baseUrl||i,s=e):(o=e,n="string"==typeof t?t:o),!n)throw new Error("You must specify the `url` property.");if(this.loading&&!s.parentResource)throw new Error("Cannot add root resources while the loader is running.");if(this.resources[o])throw new Error('Resource named "'+o+'" already exists.');n=this._prepareUrl(n,i),s.url=n;var a=new Pt(o,s);if(this.resources[o]=a,"function"==typeof s.onComplete&&a.onAfterMiddleware.once(s.onComplete),this.loading){var _=s.parentResource,c=[];for(r=0;r<_.children.length;++r)_.children[r].isComplete||c.push(_.children[r]);var u=_.progressChunk*(c.length+1)/(c.length+2);_.children.push(a),_.progressChunk=u;for(r=0;r<c.length;++r)c[r].progressChunk=u;a.progressChunk=u}return this._queue.push(a),this},e.prototype.use=function(t,r){return void 0===r&&(r=e.DefaultMiddlewarePriority),this._middleware.push({fn:t,priority:r}),this._middleware.sort((function(e,t){return e.priority-t.priority})),this},e.prototype.reset=function(){for(var e in this.progress=0,this.loading=!1,this._queue.reset(),this._queue.pause(),this.resources){var t=this.resources[e];t&&(t._onCompleteBinding&&t._onCompleteBinding.detach(),t.isLoading&&t.abort())}return this.resources={},this},e.prototype.load=function(e){if("function"==typeof e&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var t=100/this._queue.length(),r=0;r<this._queue.length();++r)this._queue.getTask(r).data.progressChunk=t;this._onStart(),this._queue.resume()}return this},Object.defineProperty(e.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e},enumerable:!0,configurable:!0}),e.prototype.addUrlResolver=function(e){return this._urlResolvers.push(e),this},e.prototype._prepareUrl=function(e,t){var r=ct(e,{strictMode:!0});if(this._urlResolvers.forEach((function(t){e=t(e,r),r=ct(e,{strictMode:!0})})),r.protocol||0===e.indexOf("//")||(e=t.length&&"/"!==e.charAt(0)?t+"/"+e:t+e),this.defaultQueryString){var n=Wt.exec(e);if(n){var o=n[0];-1!==(e=e.substr(0,e.length-o.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=o}}return e},e.prototype._loadResource=function(e,t){e._dequeue=t,e._onCompleteBinding=e.onComplete.once(this._onLoad,this),e.load()},e.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e.prototype._onLoad=function(e){var t=this;e._onCompleteBinding=null,this._resourcesParsing.push(e),e._dequeue(),function(e,t,r,n){void 0===n&&(n=!1);var o=0,i=e.length;!function s(a){a||o===i?r&&r(a):n?setTimeout((function(){return t(e[o++],s)}),1):t(e[o++],s)}()}(this._middleware,(function(r,n){r.fn.call(t,e,n)}),(function(){e.onAfterMiddleware.dispatch(e),t.progress=Math.min(100,t.progress+e.progressChunk),t.onProgress.dispatch(t,e),e.error?t.onError.dispatch(e.error,t,e):t.onLoad.dispatch(t,e),t._resourcesParsing.splice(t._resourcesParsing.indexOf(e),1),t._queue.idle()&&0===t._resourcesParsing.length&&t._onComplete()}),!0)},e.use=function(t,r){return void 0===r&&(r=e.DefaultMiddlewarePriority),e._defaultMiddleware.push({fn:t,priority:r}),e._defaultMiddleware.sort((function(e,t){return e.priority-t.priority})),e},e.DefaultMiddlewarePriority=50,e._defaultMiddleware=[]}(),function(e){e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2"}(vt||(vt={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS"}(bt||(bt={})),function(e){e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL"}(Lt||(Lt={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR"}(Mt||(Mt={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Dt||(Dt={})),function(e){e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Nt||(Nt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(Bt||(Bt={})),function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=36193]="HALF_FLOAT"}(xt||(xt={})),function(e){e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT"}(Gt||(Gt={})),function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR"}(It||(It={})),function(e){e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(wt||(wt={})),function(e){e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL"}(Ht||(Ht={})),function(e){e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(Ut||(Ut={})),function(e){e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT"}(jt||(jt={})),function(e){e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL"}(Xt||(Xt={})),function(e){e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp"}(Ft||(Ft={})),function(e){e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE"}(Kt||(Kt={})),function(e){e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH"}(kt||(kt={})),e.INTERNAL_FORMATS=void 0,(Vt=e.INTERNAL_FORMATS||(e.INTERNAL_FORMATS={}))[Vt.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",Vt[Vt.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",Vt[Vt.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",Vt[Vt.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",Vt[Vt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",Vt[Vt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",Vt[Vt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",Vt[Vt.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",Vt[Vt.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",Vt[Vt.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",Vt[Vt.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",Vt[Vt.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",Vt[Vt.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",Vt[Vt.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",Vt[Vt.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",Vt[Vt.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",Vt[Vt.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",Vt[Vt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",Vt[Vt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",Vt[Vt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",Vt[Vt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",Vt[Vt.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",Vt[Vt.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",Vt[Vt.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",Vt[Vt.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",Vt[Vt.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",Vt[Vt.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=3781]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",Vt[Vt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR";const qt={[e.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_R11_EAC]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RG11_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:.25,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:.25,[e.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_4x4_KHR]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_5x5_KHR]:.64,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_6x6_KHR]:.445,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_8x8_KHR]:.25,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_10x10_KHR]:.16,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_12x12_KHR]:.11125};class Yt{upload(e){const{levels:t}=this;for(var r=0;r<this.levels;++r){let{levelWidth:t,levelHeight:n,levelBuffer:o}=this.levelBuffers[r];e.compressedTexImage2D(e.TEXTURE_2D,r,this.internalFormat,t,n,0,o)}t>1?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR))}}const zt={[xt.UNSIGNED_BYTE]:1,[xt.UNSIGNED_SHORT]:2,[xt.FLOAT]:4,[xt.HALF_FLOAT]:8},$t={[Nt.RGBA]:4,[Nt.RGB]:3,[Nt.LUMINANCE]:1,[Nt.LUMINANCE_ALPHA]:2,[Nt.ALPHA]:1},Jt={[xt.UNSIGNED_SHORT_4_4_4_4]:2,[xt.UNSIGNED_SHORT_5_5_5_1]:2,[xt.UNSIGNED_SHORT_5_6_5]:2},Qt=12,Zt=16,er=24,tr=28,rr=36,nr=40,or=44,ir=48,sr=52,ar=56,_r=60,cr=[171,75,84,88,32,49,49,187,13,10,26,10];class ur extends Yt{constructor(e,t){super(),this.src=t,this.complete=!0;const r=new DataView(e);if(!function(e){for(let t=0;t<cr.length;t++)if(e.getUint8(t)!==cr[t])return!1;return!0}(r))throw new Error("Not a valid KTX Texture");const n=67305985===r.getUint32(Qt,!0),o=r.getUint32(Zt,n),i=r.getUint32(er,n),s=this.internalFormat=r.getUint32(tr,n),a=this.width=r.getUint32(rr,n),_=this.height=r.getUint32(nr,n)||1,c=r.getUint32(or,n)||1,u=r.getUint32(ir,n)||1,h=r.getUint32(sr,n),l=this.levels=r.getUint32(ar,n),p=r.getUint32(_r,n);if(0===_||1!==c)throw new Error("Only 2D textures are supported");if(1!==h)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const E=a+3&-4,f=_+3&-4,d=new Array(u);let R,S=a*_;if(0===o&&(S=E*f),R=0!==o?zt[o]?zt[o]*$t[i]:Jt[o]:qt[s],void 0===R)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let A=S*R,T=a,O=_,m=E,C=f,g=64+p;for(let t=0;t<l;t++){const o=r.getUint32(g,n);let i=g+4;for(let r=0;r<u;r++){let n=d[r];n||(n=d[r]=new Array(l)),n[t]={levelID:t,levelWidth:l>1?T:m,levelHeight:l>1?O:C,levelBuffer:new Uint8Array(e,i,A)},i+=A}g+=o+4,g=g%4!=0?g+4-g%4:g,T=T>>1||1,O=O>>1||1,m=T+4-1&-4,C=O+4-1&-4,A=m*C*R}if(0!==o)throw new Error("TODO: Uncompressed");this.levelBuffers=d[0]}}class hr extends Ct{_complete(e,t){super._complete(e,new ur(t,this.config.url))}}const lr={uploadNotCompressed:n.glCore.GLTexture.prototype.upload,isCompressed:!1,upload:function(e){if(!(e instanceof Yt))return this.uploadNotCompressed(e);this.bind();var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.isCompressed=!0,e.upload(t)},enableMipmap:function(){if(!this.isCompressed){var e=this.gl;this.bind(),this.mipmap=!0,e.generateMipmap(e.TEXTURE_2D)}}},pr=Symbol(),Er={[pr]:n.Texture.from,from(e){return e instanceof Yt?new n.Texture(n.BaseTexture.from(e)):this[pr](e)}},fr=Symbol(),dr={[fr]:n.BaseTexture.from,from(e,t,r){if(!(e instanceof Yt))return this[fr](e,t,r);const o=e.src;let i=n.utils.BaseTextureCache[o];return i||(i=new n.BaseTexture(e,t),i.imageUrl=o,r&&(i.sourceScale=r),n.BaseTexture.addToCache(i,o)),i}};function Rr(e){try{const t=e.renderer.gl;t.getExtension("WEBGL_compressed_texture_s3tc"),t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),t.getExtension("WEBGL_compressed_texture_etc"),t.getExtension("WEBGL_compressed_texture_etc1"),t.getExtension("WEBGL_compressed_texture_pvrtc"),t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),t.getExtension("WEBGL_compressed_texture_atc"),t.getExtension("WEBGL_compressed_texture_astc")}catch(e){console.error("Compressed texture ability failure ! The message is :",e.message)}}t.resource.addPreProcessResourceHandler((function(e){var t,r;const n=null===(r=null===(t=e.src)||void 0===t?void 0:t.image)||void 0===r?void 0:r.texture;if(!n)return;const{extensions:o,textureFormats:i,formats:s}=function(){if(ot)return ot;const e=document.createElement("canvas").getContext("webgl");if(!e)return void console.warn("WebGL not available for compressed textures. Silently failing.");const t={s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")},r={};for(const e in t){const n=t[e];n&&Object.assign(r,Object.getPrototypeOf(n))}let n=Object.values(r);return ot={extensions:t,textureFormats:r,formats:n},ot}();let a=n.find((e=>o[e.type]&&(s.includes(e.internalFormat)||i[e.internalFormat])));a&&(e.src.image.url=a.url,e.src.image.type=a.type)})),Object.assign(t.STRATEGY,{astc:hr,etc:hr,pvrtc:hr,s3tc:hr,atc:hr}),hr.setExtensionXhrType("ktx",dt.Buffer),Object.assign(n.glCore.GLTexture.prototype,lr),Object.assign(n.Texture,Er),Object.assign(n.BaseTexture,dr),e.RENDERER_TYPE=void 0,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS"}(e.RENDERER_TYPE||(e.RENDERER_TYPE={}));const Sr=e=>{e.plugins.interaction.autoPreventDefault=!0,e.view.style.touchAction="none"},Ar=e=>{e.plugins.interaction.autoPreventDefault=!1,e.view.style.touchAction="auto"};let Tr=class extends t.System{constructor(){super(...arguments),this.multiApps=[]}init(e){this.params=e,this.application=this.createApplication(e),this.containerManager=new et,this.rendererManager=new Ze({game:this.game,rendererSystem:this}),this.game.canvas=this.application.view,this.transform=new nt({system:this,containerManager:this.containerManager}),this.game.on("sceneChanged",(({scene:e,mode:r,params:n})=>{let o;switch(r){case t.LOAD_SCENE_MODE.SINGLE:o=this.application;break;case t.LOAD_SCENE_MODE.MULTI_CANVAS:o=this.createMultiApplication({params:n})}e.canvas=o.view,this.transform.emit("changeScene",{scene:e,mode:r,application:o})})),!1!==e.useCompressedTexture&&Rr(this.application)}registerObserver(e){const t=this.constructor.observerInfo;for(const r in e)t[r]||(t[r]=[]),t[r].push(...e[r])}createMultiApplication({params:e}){const t=this.createApplication(e);return this.multiApps.push(t),t}createApplication(t){t.view=t.canvas,t.renderType===e.RENDERER_TYPE.CANVAS&&(t.forceCanvas=!0),n.ticker.shared.autoStart=!1,n.ticker.shared.stop();const o=new r.Application(Object.assign({sharedTicker:!0},t));return void 0!==t.preventScroll&&(console.warn("PreventScroll property will deprecate at next major version, please use enableEnable instead. https://eva.js.org/#/tutorials/game"),t.preventScroll?Ar(o.renderer):Sr(o.renderer)),void 0!==t.enableScroll&&(t.enableScroll?Ar(o.renderer):Sr(o.renderer)),void 0===t.preventScroll&&void 0===t.enableScroll&&Ar(o.renderer),o}update(){const e=this.componentObserver.clear();for(const t of e)this.transform.componentChanged(t);for(const e of this.game.gameObjects)this.containerManager.updateTransform({name:e.id,transform:e.transform}),this.rendererManager.update(e)}lateUpdate(e){this.transform.update(),this.application.ticker.update(e.time)}onDestroy(){this.application.destroy();for(const e of this.multiApps)e&&e.destroy();this.transform.destroy(),this.transform=null,this.params=null,this.rendererManager=null,this.containerManager=null,this.application=null,this.game=null,this.multiApps=null}resize(e,t){this.params.width=e,this.params.height=t,this.application.renderer.resize(e,t)}};Tr.systemName="Renderer",Tr=o([t.decorators.componentObserver({Transform:["_parent"]})],Tr);var Or=Tr;class mr extends t.System{constructor(e){super(e),this.observerInfo=this.constructor.observerInfo}update(){const e=this.componentObserver.clear();for(const t of e)this.componentChanged(t)}}e.ContainerManager=et,e.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=qt,e.Renderer=mr,e.RendererManager=Ze,e.RendererSystem=Or,e.activeCompressedTextureAbilityOnRenderer=Rr,Object.defineProperty(e,"__esModule",{value:!0})}));
