!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/renderer-adapter"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/renderer-adapter","pixi.js"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer={}),e.EVA,e.EVA.rendererAdapter,e.PIXI)}(this,(function(e,t,r,_){"use strict";function n(e,t,r,_){var n,o=arguments.length,a=o<3?t:null===_?_=Object.getOwnPropertyDescriptor(t,r):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,_);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function o(e,t){return e===t||e!=e&&t!=t}function a(e,t){for(var r=e.length;r--;)if(o(e[r][0],t))return r;return-1}var s=Array.prototype.splice;function i(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var _=e[t];this.set(_[0],_[1])}}i.prototype.clear=function(){this.__data__=[],this.size=0},i.prototype.delete=function(e){var t=this.__data__,r=a(t,e);return!(r<0)&&(r==t.length-1?t.pop():s.call(t,r,1),--this.size,!0)},i.prototype.get=function(e){var t=this.__data__,r=a(t,e);return r<0?void 0:t[r][1]},i.prototype.has=function(e){return a(this.__data__,e)>-1},i.prototype.set=function(e,t){var r=this.__data__,_=a(r,e);return _<0?(++this.size,r.push([e,t])):r[_][1]=t,this};var E="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,R=E||S||Function("return this")(),c=R.Symbol,A=Object.prototype,u=A.hasOwnProperty,C=A.toString,T=c?c.toStringTag:void 0;var p=Object.prototype.toString;var O=c?c.toStringTag:void 0;function l(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":O&&O in Object(e)?function(e){var t=u.call(e,T),r=e[T];try{e[T]=void 0;var _=!0}catch(e){}var n=C.call(e);return _&&(t?e[T]=r:delete e[T]),n}(e):function(e){return p.call(e)}(e)}function P(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function f(e){if(!P(e))return!1;var t=l(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var h,M=R["__core-js_shared__"],d=(h=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"";var G=Function.prototype.toString;function D(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var B=/^\[object .+?Constructor\]$/,v=Function.prototype,L=Object.prototype,m=v.toString,y=L.hasOwnProperty,N=RegExp("^"+m.call(y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function b(e){return!(!P(e)||(t=e,d&&d in t))&&(f(e)?N:B).test(D(e));var t}function g(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return b(r)?r:void 0}var H=g(R,"Map"),x=g(Object,"create");var I=Object.prototype.hasOwnProperty;var j=Object.prototype.hasOwnProperty;function w(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var _=e[t];this.set(_[0],_[1])}}function F(e,t){var r,_,n=e.__data__;return("string"==(_=typeof(r=t))||"number"==_||"symbol"==_||"boolean"==_?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map}function X(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var _=e[t];this.set(_[0],_[1])}}w.prototype.clear=function(){this.__data__=x?x(null):{},this.size=0},w.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},w.prototype.get=function(e){var t=this.__data__;if(x){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return I.call(t,e)?t[e]:void 0},w.prototype.has=function(e){var t=this.__data__;return x?void 0!==t[e]:j.call(t,e)},w.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=x&&void 0===t?"__lodash_hash_undefined__":t,this},X.prototype.clear=function(){this.size=0,this.__data__={hash:new w,map:new(H||i),string:new w}},X.prototype.delete=function(e){var t=F(this,e).delete(e);return this.size-=t?1:0,t},X.prototype.get=function(e){return F(this,e).get(e)},X.prototype.has=function(e){return F(this,e).has(e)},X.prototype.set=function(e,t){var r=F(this,e),_=r.size;return r.set(e,t),this.size+=r.size==_?0:1,this};function K(e){var t=this.__data__=new i(e);this.size=t.size}K.prototype.clear=function(){this.__data__=new i,this.size=0},K.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},K.prototype.get=function(e){return this.__data__.get(e)},K.prototype.has=function(e){return this.__data__.has(e)},K.prototype.set=function(e,t){var r=this.__data__;if(r instanceof i){var _=r.__data__;if(!H||_.length<199)return _.push([e,t]),this.size=++r.size,this;r=this.__data__=new X(_)}return r.set(e,t),this.size=r.size,this};function W(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new X;++t<r;)this.add(e[t])}function V(e,t){for(var r=-1,_=null==e?0:e.length;++r<_;)if(t(e[r],r,e))return!0;return!1}W.prototype.add=W.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},W.prototype.has=function(e){return this.__data__.has(e)};function z(e,t,r,_,n,o){var a=1&r,s=e.length,i=t.length;if(s!=i&&!(a&&i>s))return!1;var E=o.get(e),S=o.get(t);if(E&&S)return E==t&&S==e;var R=-1,c=!0,A=2&r?new W:void 0;for(o.set(e,t),o.set(t,e);++R<s;){var u=e[R],C=t[R];if(_)var T=a?_(C,u,R,t,e,o):_(u,C,R,e,t,o);if(void 0!==T){if(T)continue;c=!1;break}if(A){if(!V(t,(function(e,t){if(a=t,!A.has(a)&&(u===e||n(u,e,r,_,o)))return A.push(t);var a}))){c=!1;break}}else if(u!==C&&!n(u,C,r,_,o)){c=!1;break}}return o.delete(e),o.delete(t),c}var U=R.Uint8Array;function k(e){var t=-1,r=Array(e.size);return e.forEach((function(e,_){r[++t]=[_,e]})),r}function $(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var Y=c?c.prototype:void 0,q=Y?Y.valueOf:void 0;var J=Array.isArray;var Q=Object.prototype.propertyIsEnumerable,Z=Object.getOwnPropertySymbols,ee=Z?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,_=null==e?0:e.length,n=0,o=[];++r<_;){var a=e[r];t(a,r,e)&&(o[n++]=a)}return o}(Z(e),(function(t){return Q.call(e,t)})))}:function(){return[]};function te(e){return null!=e&&"object"==typeof e}function re(e){return te(e)&&"[object Arguments]"==l(e)}var _e=Object.prototype,ne=_e.hasOwnProperty,oe=_e.propertyIsEnumerable,ae=re(function(){return arguments}())?re:function(e){return te(e)&&ne.call(e,"callee")&&!oe.call(e,"callee")};var se="object"==typeof e&&e&&!e.nodeType&&e,ie=se&&"object"==typeof module&&module&&!module.nodeType&&module,Ee=ie&&ie.exports===se?R.Buffer:void 0,Se=(Ee?Ee.isBuffer:void 0)||function(){return!1},Re=/^(?:0|[1-9]\d*)$/;function ce(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Re.test(e))&&e>-1&&e%1==0&&e<t}function Ae(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var ue={};ue["[object Float32Array]"]=ue["[object Float64Array]"]=ue["[object Int8Array]"]=ue["[object Int16Array]"]=ue["[object Int32Array]"]=ue["[object Uint8Array]"]=ue["[object Uint8ClampedArray]"]=ue["[object Uint16Array]"]=ue["[object Uint32Array]"]=!0,ue["[object Arguments]"]=ue["[object Array]"]=ue["[object ArrayBuffer]"]=ue["[object Boolean]"]=ue["[object DataView]"]=ue["[object Date]"]=ue["[object Error]"]=ue["[object Function]"]=ue["[object Map]"]=ue["[object Number]"]=ue["[object Object]"]=ue["[object RegExp]"]=ue["[object Set]"]=ue["[object String]"]=ue["[object WeakMap]"]=!1;var Ce,Te="object"==typeof e&&e&&!e.nodeType&&e,pe=Te&&"object"==typeof module&&module&&!module.nodeType&&module,Oe=pe&&pe.exports===Te&&E.process,le=function(){try{var e=pe&&pe.require&&pe.require("util").types;return e||Oe&&Oe.binding&&Oe.binding("util")}catch(e){}}(),Pe=le&&le.isTypedArray,fe=Pe?(Ce=Pe,function(e){return Ce(e)}):function(e){return te(e)&&Ae(e.length)&&!!ue[l(e)]},he=Object.prototype.hasOwnProperty;function Me(e,t){var r=J(e),_=!r&&ae(e),n=!r&&!_&&Se(e),o=!r&&!_&&!n&&fe(e),a=r||_||n||o,s=a?function(e,t){for(var r=-1,_=Array(e);++r<e;)_[r]=t(r);return _}(e.length,String):[],i=s.length;for(var E in e)!t&&!he.call(e,E)||a&&("length"==E||n&&("offset"==E||"parent"==E)||o&&("buffer"==E||"byteLength"==E||"byteOffset"==E)||ce(E,i))||s.push(E);return s}var de=Object.prototype;var Ge=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),De=Object.prototype.hasOwnProperty;function Be(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||de))return Ge(e);var t,r,_=[];for(var n in Object(e))De.call(e,n)&&"constructor"!=n&&_.push(n);return _}function ve(e){return null!=(t=e)&&Ae(t.length)&&!f(t)?Me(e):Be(e);var t}function Le(e){return function(e,t,r){var _=t(e);return J(e)?_:function(e,t){for(var r=-1,_=t.length,n=e.length;++r<_;)e[n+r]=t[r];return e}(_,r(e))}(e,ve,ee)}var me=Object.prototype.hasOwnProperty;var ye=g(R,"DataView"),Ne=g(R,"Promise"),be=g(R,"Set"),ge=g(R,"WeakMap"),He="[object Map]",xe="[object Promise]",Ie="[object Set]",je="[object WeakMap]",we="[object DataView]",Fe=D(ye),Xe=D(H),Ke=D(Ne),We=D(be),Ve=D(ge),ze=l;(ye&&ze(new ye(new ArrayBuffer(1)))!=we||H&&ze(new H)!=He||Ne&&ze(Ne.resolve())!=xe||be&&ze(new be)!=Ie||ge&&ze(new ge)!=je)&&(ze=function(e){var t=l(e),r="[object Object]"==t?e.constructor:void 0,_=r?D(r):"";if(_)switch(_){case Fe:return we;case Xe:return He;case Ke:return xe;case We:return Ie;case Ve:return je}return t});var Ue=ze,ke="[object Arguments]",$e="[object Array]",Ye="[object Object]",qe=Object.prototype.hasOwnProperty;function Je(e,t,r,_,n,a){var s=J(e),i=J(t),E=s?$e:Ue(e),S=i?$e:Ue(t),R=(E=E==ke?Ye:E)==Ye,c=(S=S==ke?Ye:S)==Ye,A=E==S;if(A&&Se(e)){if(!Se(t))return!1;s=!0,R=!1}if(A&&!R)return a||(a=new K),s||fe(e)?z(e,t,r,_,n,a):function(e,t,r,_,n,a,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new U(e),new U(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var i=k;case"[object Set]":var E=1&_;if(i||(i=$),e.size!=t.size&&!E)return!1;var S=s.get(e);if(S)return S==t;_|=2,s.set(e,t);var R=z(i(e),i(t),_,n,a,s);return s.delete(e),R;case"[object Symbol]":if(q)return q.call(e)==q.call(t)}return!1}(e,t,E,r,_,n,a);if(!(1&r)){var u=R&&qe.call(e,"__wrapped__"),C=c&&qe.call(t,"__wrapped__");if(u||C){var T=u?e.value():e,p=C?t.value():t;return a||(a=new K),n(T,p,r,_,a)}}return!!A&&(a||(a=new K),function(e,t,r,_,n,o){var a=1&r,s=Le(e),i=s.length;if(i!=Le(t).length&&!a)return!1;for(var E=i;E--;){var S=s[E];if(!(a?S in t:me.call(t,S)))return!1}var R=o.get(e),c=o.get(t);if(R&&c)return R==t&&c==e;var A=!0;o.set(e,t),o.set(t,e);for(var u=a;++E<i;){var C=e[S=s[E]],T=t[S];if(_)var p=a?_(T,C,S,t,e,o):_(C,T,S,e,t,o);if(!(void 0===p?C===T||n(C,T,r,_,o):p)){A=!1;break}u||(u="constructor"==S)}if(A&&!u){var O=e.constructor,l=t.constructor;O==l||!("constructor"in e)||!("constructor"in t)||"function"==typeof O&&O instanceof O&&"function"==typeof l&&l instanceof l||(A=!1)}return o.delete(e),o.delete(t),A}(e,t,r,_,n,a))}function Qe(e,t,r,_,n){return e===t||(null==e||null==t||!te(e)&&!te(t)?e!=e&&t!=t:Je(e,t,r,_,Qe,n))}class Ze{constructor({game:e,rendererSystem:t}){this.renderers=[],this.game=e,this.rendererSystem=t}register(...e){for(const t of e)t.game=this.game,t.rendererManager=this.rendererSystem.rendererManager,t.containerManager=this.rendererSystem.containerManager,this.renderers.push(t)}componentChanged(e){for(const r of e)for(const e of this.renderers){const _=e.observerInfo[r.componentName];if(_){if([t.OBSERVER_TYPE.ADD,t.OBSERVER_TYPE.REMOVE].indexOf(r.type)>-1){try{e.componentChanged&&e.componentChanged(r)}catch(e){console.error(`gameObject: ${r.gameObject.name}, ${r.componentName} is error.`,r,e)}continue}if(_.findIndex((e=>{return t=e,_=r.prop,Qe(t,_);var t,_}))>-1)try{e.componentChanged&&e.componentChanged(r)}catch(e){console.error(`gameObject: ${r.gameObject&&r.gameObject.name}, ${r.componentName} is componentChanged error.`,r,e)}}}}update(e){for(const t of e.components)for(const r of this.renderers){const _=[];if(r.observerInfo[t.name]&&-1===_.indexOf(e)){_.push(e);try{r.rendererUpdate&&r.rendererUpdate(e)}catch(r){console.info(`gameObject: ${e.name}, ${t.name} is update error`,r)}}}}}class et{constructor(){this.containerMap={}}addContainer({name:e,container:t}){this.containerMap[e]=t}getContainer(e){return this.containerMap[e]}removeContainer(e){var t;null===(t=this.containerMap[e])||void 0===t||t.destroy({children:!0}),delete this.containerMap[e]}updateTransform({name:e,transform:t}){const r=this.containerMap[e];if(!r)return;const{anchor:_,origin:n,position:o,rotation:a,scale:s,size:i,skew:E}=t;r.rotation=a,r.scale=s,r.pivot.x=i.width*n.x,r.pivot.y=i.height*n.y,r.skew=E;let S=o.x,R=o.y;if(t.parent){const e=t.parent;S+=e.size.width*_.x,R+=e.size.height*_.y}r.position={x:S,y:R}}}var tt=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,r="~";function _(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,_,o,a){if("function"!=typeof _)throw new TypeError("The listener must be a function");var s=new n(_,o||e,a),i=r?r+t:t;return e._events[i]?e._events[i].fn?e._events[i]=[e._events[i],s]:e._events[i].push(s):(e._events[i]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new _:delete e._events[t]}function s(){this._events=new _,this._eventsCount=0}Object.create&&(_.prototype=Object.create(null),(new _).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,_,n=[];if(0===this._eventsCount)return n;for(_ in e=this._events)t.call(e,_)&&n.push(r?_.slice(1):_);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(e){var t=r?r+e:e,_=this._events[t];if(!_)return[];if(_.fn)return[_.fn];for(var n=0,o=_.length,a=new Array(o);n<o;n++)a[n]=_[n].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,_=this._events[t];return _?_.fn?1:_.length:0},s.prototype.emit=function(e,t,_,n,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var i,E,S=this._events[s],R=arguments.length;if(S.fn){switch(S.once&&this.removeListener(e,S.fn,void 0,!0),R){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,t),!0;case 3:return S.fn.call(S.context,t,_),!0;case 4:return S.fn.call(S.context,t,_,n),!0;case 5:return S.fn.call(S.context,t,_,n,o),!0;case 6:return S.fn.call(S.context,t,_,n,o,a),!0}for(E=1,i=new Array(R-1);E<R;E++)i[E-1]=arguments[E];S.fn.apply(S.context,i)}else{var c,A=S.length;for(E=0;E<A;E++)switch(S[E].once&&this.removeListener(e,S[E].fn,void 0,!0),R){case 1:S[E].fn.call(S[E].context);break;case 2:S[E].fn.call(S[E].context,t);break;case 3:S[E].fn.call(S[E].context,t,_);break;case 4:S[E].fn.call(S[E].context,t,_,n);break;default:if(!i)for(c=1,i=new Array(R-1);c<R;c++)i[c-1]=arguments[c];S[E].fn.apply(S[E].context,i)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,_,n){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||n&&!s.once||_&&s.context!==_||a(this,o);else{for(var i=0,E=[],S=s.length;i<S;i++)(s[i].fn!==t||n&&!s[i].once||_&&s[i].context!==_)&&E.push(s[i]);E.length?this._events[o]=1===E.length?E[0]:E:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new _,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}));let rt=class extends tt{constructor({system:e,containerManager:t}){super(),this.name="Transform",this.waitRemoveIds=[],this.waitChangeScenes=[],this.containerManager=t,this.init(e)}init(e){this.system=e,this.on("changeScene",(({scene:e,mode:t,application:r})=>{this.waitChangeScenes.push({scene:e,mode:t,application:r})}))}update(){for(const e of this.waitRemoveIds)this.containerManager.removeContainer(e);this.waitRemoveIds=[];for(const e of this.waitChangeScenes){const t=this.containerManager.getContainer(e.scene.id);t&&(e.application.stage.removeChildren(),e.application.stage.addChild(t))}this.waitChangeScenes=[]}componentChanged(e){e.type===t.OBSERVER_TYPE.ADD?this.addContainer(e):e.type===t.OBSERVER_TYPE.CHANGE?this.change(e):e.type===t.OBSERVER_TYPE.REMOVE&&this.waitRemoveIds.push(e.gameObject.id)}addContainer(e){const t=new r.Container;t.name=e.gameObject.name,this.containerManager.addContainer({name:e.gameObject.id,container:t});e.component.worldTransform=t.transform.worldTransform}change(e){const t=e.component;if(t.parent){this.containerManager.getContainer(t.parent.gameObject.id).addChild(this.containerManager.getContainer(e.gameObject.id));const r=e.gameObject.transform.parent&&e.gameObject.transform.parent.gameObject.getComponent("Render");r&&(r.sortDirty=!0)}else{const r=this.containerManager.getContainer(e.gameObject.id);delete t.worldTransform,r.parent&&r.parent.removeChild(r)}}destroy(){this.removeAllListeners(),this.waitRemoveIds=null,this.waitChangeScenes=null,this.system=null,this.containerManager=null}};rt=n([t.decorators.componentObserver({Transform:["_parent"]})],rt);var _t,nt=rt;e.INTERNAL_FORMATS=void 0,(_t=e.INTERNAL_FORMATS||(e.INTERNAL_FORMATS={}))[_t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",_t[_t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",_t[_t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",_t[_t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",_t[_t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",_t[_t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",_t[_t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",_t[_t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",_t[_t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",_t[_t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",_t[_t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",_t[_t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",_t[_t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",_t[_t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",_t[_t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",_t[_t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",_t[_t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",_t[_t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",_t[_t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",_t[_t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",_t[_t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",_t[_t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",_t[_t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",_t[_t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",_t[_t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",_t[_t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",_t[_t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",_t[_t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",_t[_t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",_t[_t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",_t[_t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",_t[_t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",_t[_t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",_t[_t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",_t[_t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",_t[_t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",_t[_t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",_t[_t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",_t[_t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",_t[_t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=3781]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",_t[_t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR";const ot={[e.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:1,[e.INTERNAL_FORMATS.COMPRESSED_R11_EAC]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RG11_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:.25,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:.25,[e.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]:.5,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_4x4_KHR]:1,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_5x5_KHR]:.64,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_6x6_KHR]:.445,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_8x8_KHR]:.25,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_10x10_KHR]:.16,[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_12x12_KHR]:.11125},at={[e.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]:"WEBGL_compressed_texture_s3tc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]:"WEBGL_compressed_texture_s3tc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]:"WEBGL_compressed_texture_s3tc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]:"WEBGL_compressed_texture_s3tc",[e.INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]:"WEBGL_compressed_texture_s3tc_srgb",[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:"WEBGL_compressed_texture_s3tc_srgb",[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:"WEBGL_compressed_texture_s3tc_srgb",[e.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:"WEBGL_compressed_texture_s3tc_srgb",[e.INTERNAL_FORMATS.COMPRESSED_R11_EAC]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_RG11_EAC]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:"WEBGL_compressed_texture_etc",[e.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:"WEBGL_compressed_texture_pvrtc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:"WEBGL_compressed_texture_pvrtc",[e.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:"WEBGL_compressed_texture_pvrtc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:"WEBGL_compressed_texture_pvrtc",[e.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]:"WEBGL_compressed_texture_etc1",[e.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]:"WEBGL_compressed_texture_atc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]:"WEBGL_compressed_texture_atc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]:"WEBGL_compressed_texture_atc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_4x4_KHR]:"WEBGL_compressed_texture_astc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_5x5_KHR]:"WEBGL_compressed_texture_astc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_6x6_KHR]:"WEBGL_compressed_texture_astc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_8x8_KHR]:"WEBGL_compressed_texture_astc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_10x10_KHR]:"WEBGL_compressed_texture_astc",[e.INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_12x12_KHR]:"WEBGL_compressed_texture_astc"};var st;e.RENDERER_TYPE=void 0,(st=e.RENDERER_TYPE||(e.RENDERER_TYPE={}))[st.UNKNOWN=0]="UNKNOWN",st[st.WEBGL=1]="WEBGL",st[st.CANVAS=2]="CANVAS";const it=e=>{e.plugins.interaction.autoPreventDefault=!0,e.view.style.touchAction="none"},Et=e=>{e.plugins.interaction.autoPreventDefault=!1,e.view.style.touchAction="auto"};let St=class extends t.System{constructor(){super(...arguments),this.multiApps=[]}init(e){this.params=e,this.application=this.createApplication(e),this.containerManager=new et,this.rendererManager=new Ze({game:this.game,rendererSystem:this}),this.game.canvas=this.application.view,this.transform=new nt({system:this,containerManager:this.containerManager}),this.game.on("sceneChanged",(({scene:e,mode:r,params:_})=>{let n;switch(r){case t.LOAD_SCENE_MODE.SINGLE:n=this.application;break;case t.LOAD_SCENE_MODE.MULTI_CANVAS:n=this.createMultiApplication({params:_})}e.canvas=n.view,this.transform.emit("changeScene",{scene:e,mode:r,application:n})}))}registerObserver(e){const t=this.constructor.observerInfo;for(const r in e)t[r]||(t[r]=[]),t[r].push(...e[r])}createMultiApplication({params:e}){const t=this.createApplication(e);return this.multiApps.push(t),t}createApplication(t){t.view=t.canvas,t.renderType===e.RENDERER_TYPE.CANVAS&&(t.forceCanvas=!0),_.ticker.shared.autoStart=!1,_.ticker.shared.stop();const n=new r.Application(Object.assign({sharedTicker:!0},t));return void 0!==t.preventScroll&&(console.warn("PreventScroll property will deprecate at next major version, please use enableEnable instead. https://eva.js.org/#/tutorials/game"),t.preventScroll?Et(n.renderer):it(n.renderer)),void 0!==t.enableScroll&&(t.enableScroll?Et(n.renderer):it(n.renderer)),void 0===t.preventScroll&&void 0===t.enableScroll&&Et(n.renderer),n}update(){const e=this.componentObserver.clear();for(const t of e)this.transform.componentChanged(t);for(const e of this.game.gameObjects)this.containerManager.updateTransform({name:e.id,transform:e.transform}),this.rendererManager.update(e)}lateUpdate(e){this.transform.update(),this.application.ticker.update(e.time)}onDestroy(){this.application.destroy();for(const e of this.multiApps)e&&e.destroy();this.transform.destroy(),this.transform=null,this.params=null,this.rendererManager=null,this.containerManager=null,this.application=null,this.game=null,this.multiApps=null}resize(e,t){this.params.width=e,this.params.height=t,this.application.renderer.resize(e,t)}};St.systemName="Renderer",St=n([t.decorators.componentObserver({Transform:["_parent"]})],St);var Rt=St;class ct extends t.System{constructor(e){super(e),this.observerInfo=this.constructor.observerInfo}componentChanged(e){}rendererUpdate(e){}update(){const e=this.componentObserver.clear();for(const t of e)this.componentChanged(t)}}e.ContainerManager=et,e.INTERNAL_FORMATS_TO_EXTENSION_NAME=at,e.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=ot,e.Renderer=ct,e.RendererManager=Ze,e.RendererSystem=Rt,Object.defineProperty(e,"__esModule",{value:!0})}));
