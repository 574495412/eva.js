var e,t;e=this,t=function(e,t,i,n,r){"use strict";function a(e,t,i,n){var r,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,i,o):r(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o}function o(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{p(n.next(e))}catch(e){a(e)}}function s(e){try{p(n.throw(e))}catch(e){a(e)}}function p(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}p((n=n.apply(e,t||[])).next())}))}class s extends t.Component{constructor(){super(...arguments),this.resource="",this.autoPlay=!0,this.speed=100,this.waitPlay=!1,this.waitStop=!1,this.times=1/0,this.count=0}init(e){e&&Object.assign(this,e),this.on("loop",(()=>{++this.count>=this.times&&(this.animate.stop(),this.emit("complete"))}))}play(e=1/0){0!==e&&(this.times=e,this.animate?(this.animate.play(),this.count=0):this.waitPlay=!0)}stop(){this.animate?this.animate.stop():this.waitStop=!0}set animate(e){this._animate=e,this.waitPlay&&(this.waitPlay=!1,this.play(this.times)),this.waitStop&&(this.waitStop=!1,this.stop())}get animate(){return this._animate}gotoAndPlay(e){this.animate.gotoAndPlay(e)}gotoAndStop(e){this.animate.gotoAndStop(e)}}s.componentName="SpriteAnimation",a([t.decorators.IDEProp],s.prototype,"resource",void 0),a([t.decorators.IDEProp],s.prototype,"autoPlay",void 0),a([t.decorators.IDEProp],s.prototype,"speed",void 0);const p="_s|r|c_";t.resource.registerInstance(t.RESOURCE_TYPE.SPRITE_ANIMATION,(({name:e,data:t})=>new Promise((i=>{const n=t.json,a=r.BaseTexture.from(t.image),o=n.frames||{},s=n.animations||{},m={};for(const t in o)m[e+p+t]=o[t];for(const t in s){const i=[];if(s[t]&&s[t].length>=0)for(const n of s[t]){const t=e+p+n;i.push(t)}s[t]=i}n.frames=m;const c=new r.Spritesheet(a,n);c.parse((()=>{const{textures:e}=c,t=[];for(const i in e)t.push(e[i]);i(t)}))})))),t.resource.registerDestroy(t.RESOURCE_TYPE.SPRITE_ANIMATION,(({instance:e})=>{if(e)for(const t of e)t.destroy(!0)}));let m=class extends i.Renderer{constructor(){super(...arguments),this.name="SpriteAnimation",this.animates={},this.autoPlay={}}init(){this.renderSystem=this.game.getSystem(i.RendererSystem),this.renderSystem.rendererManager.register(this)}rendererUpdate(e){const{width:t,height:i}=e.transform.size;this.animates[e.id]&&(this.animates[e.id].animatedSprite.width=t,this.animates[e.id].animatedSprite.height=i)}componentChanged(e){return o(this,void 0,void 0,(function*(){if("SpriteAnimation"===e.componentName){const i=e.component;if(this.autoPlay[e.gameObject.id]=i.autoPlay,e.type===t.OBSERVER_TYPE.ADD){const{instance:n}=yield t.resource.getResource(i.resource);n||console.error(`GameObject:${e.gameObject.name}'s Img resource load error`),this.add({frames:n,id:e.gameObject.id,component:i})}else if(e.type===t.OBSERVER_TYPE.CHANGE)if(e.prop&&"speed"===e.prop.prop[0])this.animates[e.gameObject.id].speed=1e3/60/i.speed;else{const{instance:n}=yield t.resource.getResource(i.resource);n||console.error(`GameObject:${e.gameObject.name}'s Img resource load error`),this.change({frames:n,id:e.gameObject.id,component:i})}else e.type===t.OBSERVER_TYPE.REMOVE&&this.remove(e.gameObject.id)}}))}add({frames:e,id:t,component:i}){const r=new n.SpriteAnimation({frames:e});this.animates[t]=r,this.containerManager.getContainer(t).addChildAt(r.animatedSprite,0),r.animatedSprite.onComplete=()=>{i.emit("complete")},r.animatedSprite.onFrameChange=()=>{i.emit("frameChange")},r.animatedSprite.onLoop=()=>{i.emit("loop")},i.animate=this.animates[t],this.animates[t].speed=1e3/60/i.speed,this.autoPlay[t]&&r.animatedSprite.play()}change({frames:e,id:t,component:i}){this.remove(t,!0),this.add({frames:e,id:t,component:i})}remove(e,t){const i=this.animates[e];this.autoPlay[e]=i.animatedSprite.playing,this.containerManager.getContainer(e).removeChild(i.animatedSprite),i.animatedSprite.destroy(),delete this.animates[e],t||delete this.autoPlay[e]}};m.systemName="SpriteAnimation",m=a([t.decorators.componentObserver({SpriteAnimation:["speed","resource"]})],m);var c=m;e.SpriteAnimation=s,e.SpriteAnimationSystem=c,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@eva/eva.js"),require("@eva/plugin-renderer"),require("@eva/renderer-adapter"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@eva/eva.js","@eva/plugin-renderer","@eva/renderer-adapter","pixi.js"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).EVA=e.EVA||{},e.EVA.plugin=e.EVA.plugin||{},e.EVA.plugin.renderer=e.EVA.plugin.renderer||{},e.EVA.plugin.renderer.spriteAnimation={}),e.EVA,e.EVA.plugin.renderer,e.EVA.rendererAdapter,e.PIXI);
